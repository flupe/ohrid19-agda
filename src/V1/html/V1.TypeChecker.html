<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>V1.TypeChecker</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Type checker for the WHILE language.</a>

<a id="42" class="Symbol">{-#</a> <a id="46" class="Keyword">OPTIONS</a> <a id="54" class="Pragma">--postfix-projections</a> <a id="76" class="Symbol">#-}</a>

<a id="81" class="Keyword">module</a> <a id="88" href="V1.TypeChecker.html" class="Module">V1.TypeChecker</a> <a id="103" class="Keyword">where</a>

<a id="110" class="Keyword">open</a> <a id="115" class="Keyword">import</a> <a id="122" href="Library.html" class="Module">Library</a>

<a id="131" class="Keyword">import</a> <a id="138" href="V1.AST.html" class="Module">V1.AST</a> <a id="145" class="Symbol">as</a> <a id="148" class="Module">A</a>
<a id="150" class="Keyword">open</a> <a id="155" class="Keyword">import</a> <a id="162" href="V1.WellTypedSyntax.html" class="Module">V1.WellTypedSyntax</a>

<a id="182" class="Comment">-- Type errors.</a>
<a id="198" class="Comment">--</a>
<a id="201" class="Comment">-- Currently, these errors do not carry enough evidence that</a>
<a id="262" class="Comment">-- something is wrong.  The type checker does not produce</a>
<a id="320" class="Comment">-- evidence of ill-typedness in case of failure,</a>
<a id="369" class="Comment">-- only of well-typedness in case of success.</a>

<a id="416" class="Keyword">data</a> <a id="TypeError"></a><a id="421" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a> <a id="431" class="Symbol">:</a> <a id="433" class="PrimitiveType">Set</a> <a id="437" class="Keyword">where</a>
  <a id="TypeError.typeMismatch"></a><a id="445" href="V1.TypeChecker.html#445" class="InductiveConstructor">typeMismatch</a> <a id="458" class="Symbol">:</a> <a id="460" class="Symbol">(</a><a id="461" href="V1.TypeChecker.html#461" class="Bound">tinf</a> <a id="466" href="V1.TypeChecker.html#466" class="Bound">texp</a> <a id="471" class="Symbol">:</a> <a id="473" href="V1.AST.html#282" class="Datatype">Type</a><a id="477" class="Symbol">)</a>  <a id="480" class="Symbol">→</a> <a id="482" href="V1.TypeChecker.html#461" class="Bound">tinf</a> <a id="487" href="Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">≢</a> <a id="489" href="V1.TypeChecker.html#466" class="Bound">texp</a> <a id="494" class="Symbol">→</a> <a id="496" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a>

<a id="507" class="Keyword">instance</a>
  <a id="PrintError"></a><a id="518" href="V1.TypeChecker.html#518" class="Function">PrintError</a> <a id="529" class="Symbol">:</a> <a id="531" href="Library.Print.html#196" class="Record">Print</a> <a id="537" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a>
  <a id="549" href="Library.Print.html#244" class="Field">print</a> <a id="555" class="Symbol">{{</a><a id="557" href="V1.TypeChecker.html#518" class="Function">PrintError</a><a id="567" class="Symbol">}}</a> <a id="570" class="Symbol">=</a> <a id="572" class="Symbol">λ</a> <a id="574" class="Keyword">where</a>
    <a id="584" class="Symbol">(</a><a id="585" href="V1.TypeChecker.html#445" class="InductiveConstructor">typeMismatch</a> <a id="598" href="V1.TypeChecker.html#598" class="Bound">tinf</a> <a id="603" href="V1.TypeChecker.html#603" class="Bound">texp</a> <a id="608" class="Symbol">_)</a> <a id="611" class="Symbol">→</a> <a id="613" href="Data.String.Base.html#1932" class="Function">String.concat</a> <a id="627" href="Function.html#1645" class="Function Operator">$</a>
      <a id="635" class="String">&quot;type mismatch: expected &quot;</a> <a id="662" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="664" href="Library.Print.html#244" class="Field">print</a> <a id="670" href="V1.TypeChecker.html#603" class="Bound">texp</a> <a id="675" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a>
      <a id="683" class="String">&quot;, but inferred &quot;</a> <a id="701" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="703" href="Library.Print.html#244" class="Field">print</a> <a id="709" href="V1.TypeChecker.html#598" class="Bound">tinf</a> <a id="714" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="716" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a>

<a id="720" class="Comment">-- Type error monad.</a>

<a id="742" class="Keyword">open</a> <a id="747" href="Library.Error.html#134" class="Module">ErrorMonad</a> <a id="758" class="Symbol">{</a><a id="759" class="Argument">E</a> <a id="761" class="Symbol">=</a> <a id="763" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a><a id="772" class="Symbol">}</a>

<a id="775" class="Comment">-- Checking expressions</a>
<a id="799" class="Comment">---------------------------------------------------------------------------</a>

<a id="876" class="Keyword">mutual</a>

  <a id="886" class="Comment">-- Type inference.</a>

  <a id="inferExp"></a><a id="908" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="917" class="Symbol">:</a> <a id="919" class="Symbol">(</a><a id="920" href="V1.TypeChecker.html#920" class="Bound">e</a> <a id="922" class="Symbol">:</a> <a id="924" href="V1.AST.html#494" class="Datatype">A.Exp</a><a id="929" class="Symbol">)</a> <a id="931" class="Symbol">→</a> <a id="933" href="Library.Error.html#170" class="Function">Error</a> <a id="939" class="Symbol">(</a><a id="940" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="942" href="V1.AST.html#282" class="Datatype">Type</a> <a id="947" class="Symbol">(λ</a> <a id="950" href="V1.TypeChecker.html#950" class="Bound">t</a> <a id="952" class="Symbol">→</a> <a id="954" href="V1.WellTypedSyntax.html#367" class="Datatype">Exp</a> <a id="958" href="V1.TypeChecker.html#950" class="Bound">t</a><a id="959" class="Symbol">))</a>
  <a id="964" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="973" class="Symbol">(</a><a id="974" href="V1.AST.html#512" class="InductiveConstructor">A.eInt</a> <a id="981" href="V1.TypeChecker.html#981" class="Bound">i</a><a id="982" class="Symbol">)</a>  <a id="985" class="Symbol">=</a> <a id="987" href="Library.Monad.html#1110" class="Function">return</a> <a id="994" class="Symbol">(</a><a id="995" href="V1.AST.html#306" class="InductiveConstructor">int</a>  <a id="1000" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1002" href="V1.WellTypedSyntax.html#407" class="InductiveConstructor">eInt</a>  <a id="1008" href="V1.TypeChecker.html#981" class="Bound">i</a><a id="1009" class="Symbol">)</a>
  <a id="1013" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1022" class="Symbol">(</a><a id="1023" href="V1.AST.html#546" class="InductiveConstructor">A.eBool</a> <a id="1031" href="V1.TypeChecker.html#1031" class="Bound">b</a><a id="1032" class="Symbol">)</a> <a id="1034" class="Symbol">=</a> <a id="1036" href="Library.Monad.html#1110" class="Function">return</a> <a id="1043" class="Symbol">(</a><a id="1044" href="V1.AST.html#301" class="InductiveConstructor">bool</a> <a id="1049" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1051" href="V1.WellTypedSyntax.html#465" class="InductiveConstructor">eBool</a> <a id="1057" href="V1.TypeChecker.html#1031" class="Bound">b</a><a id="1058" class="Symbol">)</a>
  <a id="1062" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1071" class="Symbol">(</a><a id="1072" href="V1.AST.html#580" class="InductiveConstructor">A.ePlus</a> <a id="1080" href="V1.TypeChecker.html#1080" class="Bound">e₁</a> <a id="1083" href="V1.TypeChecker.html#1083" class="Bound">e₂</a><a id="1085" class="Symbol">)</a> <a id="1087" class="Symbol">=</a> <a id="1089" href="V1.TypeChecker.html#1525" class="Function">inferOp</a> <a id="1097" href="V1.WellTypedSyntax.html#249" class="InductiveConstructor">plus</a>  <a id="1103" href="V1.TypeChecker.html#1080" class="Bound">e₁</a> <a id="1106" href="V1.TypeChecker.html#1083" class="Bound">e₂</a>
  <a id="1111" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1120" class="Symbol">(</a><a id="1121" href="V1.AST.html#614" class="InductiveConstructor">A.eGt</a>   <a id="1129" href="V1.TypeChecker.html#1129" class="Bound">e₁</a> <a id="1132" href="V1.TypeChecker.html#1132" class="Bound">e₂</a><a id="1134" class="Symbol">)</a> <a id="1136" class="Symbol">=</a> <a id="1138" href="V1.TypeChecker.html#1525" class="Function">inferOp</a> <a id="1146" href="V1.WellTypedSyntax.html#271" class="InductiveConstructor">gt</a>    <a id="1152" href="V1.TypeChecker.html#1129" class="Bound">e₁</a> <a id="1155" href="V1.TypeChecker.html#1132" class="Bound">e₂</a>
  <a id="1160" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1169" class="Symbol">(</a><a id="1170" href="V1.AST.html#648" class="InductiveConstructor">A.eAnd</a>  <a id="1178" href="V1.TypeChecker.html#1178" class="Bound">e₁</a> <a id="1181" href="V1.TypeChecker.html#1181" class="Bound">e₂</a><a id="1183" class="Symbol">)</a> <a id="1185" class="Symbol">=</a> <a id="1187" href="V1.TypeChecker.html#1525" class="Function">inferOp</a> <a id="1195" href="V1.WellTypedSyntax.html#294" class="InductiveConstructor">and</a>   <a id="1201" href="V1.TypeChecker.html#1178" class="Bound">e₁</a> <a id="1204" href="V1.TypeChecker.html#1181" class="Bound">e₂</a>

  <a id="1210" class="Comment">-- Type checking.</a>
  <a id="1230" class="Comment">-- Calls inference and checks inferred type against given type.</a>

  <a id="checkExp"></a><a id="1297" href="V1.TypeChecker.html#1297" class="Function">checkExp</a> <a id="1306" class="Symbol">:</a> <a id="1308" class="Symbol">(</a><a id="1309" href="V1.TypeChecker.html#1309" class="Bound">e</a> <a id="1311" class="Symbol">:</a> <a id="1313" href="V1.AST.html#494" class="Datatype">A.Exp</a><a id="1318" class="Symbol">)</a> <a id="1320" class="Symbol">(</a><a id="1321" href="V1.TypeChecker.html#1321" class="Bound">t</a> <a id="1323" class="Symbol">:</a> <a id="1325" href="V1.AST.html#282" class="Datatype">Type</a><a id="1329" class="Symbol">)</a> <a id="1331" class="Symbol">→</a> <a id="1333" href="Library.Error.html#170" class="Function">Error</a> <a id="1339" class="Symbol">(</a><a id="1340" href="V1.WellTypedSyntax.html#367" class="Datatype">Exp</a> <a id="1344" href="V1.TypeChecker.html#1321" class="Bound">t</a><a id="1345" class="Symbol">)</a>
  <a id="1349" href="V1.TypeChecker.html#1297" class="Function">checkExp</a> <a id="1358" href="V1.TypeChecker.html#1358" class="Bound">e</a> <a id="1360" href="V1.TypeChecker.html#1360" class="Bound">t</a> <a id="1362" class="Symbol">=</a> <a id="1364" class="Keyword">do</a>
    <a id="1371" class="Symbol">(</a><a id="1372" href="V1.TypeChecker.html#1372" class="Bound">t&#39;</a> <a id="1375" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1377" href="V1.TypeChecker.html#1377" class="Bound">e&#39;</a><a id="1379" class="Symbol">)</a> <a id="1381" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1383" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1392" href="V1.TypeChecker.html#1358" class="Bound">e</a>
    <a id="1398" href="Function.html#3662" class="Function Operator">case</a> <a id="1403" href="V1.TypeChecker.html#1372" class="Bound">t&#39;</a> <a id="1406" href="Library.Eq.html#627" class="Field Operator">≟</a> <a id="1408" href="V1.TypeChecker.html#1360" class="Bound">t</a> <a id="1410" href="Function.html#3662" class="Function Operator">of</a> <a id="1413" class="Symbol">λ</a> <a id="1415" class="Keyword">where</a>
      <a id="1427" class="Symbol">(</a><a id="1428" href="Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="1432" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1436" class="Symbol">)</a> <a id="1438" class="Symbol">→</a> <a id="1440" href="Library.Monad.html#1110" class="Function">return</a> <a id="1447" href="V1.TypeChecker.html#1377" class="Bound">e&#39;</a>
      <a id="1456" class="Symbol">(</a><a id="1457" href="Relation.Nullary.html#668" class="InductiveConstructor">no</a>  <a id="1461" href="V1.TypeChecker.html#1461" class="Bound">t&#39;≢t</a><a id="1465" class="Symbol">)</a> <a id="1467" class="Symbol">→</a> <a id="1469" href="Library.Error.html#912" class="Function">throwError</a> <a id="1480" class="Symbol">(</a><a id="1481" href="V1.TypeChecker.html#445" class="InductiveConstructor">typeMismatch</a> <a id="1494" href="V1.TypeChecker.html#1372" class="Bound">t&#39;</a> <a id="1497" href="V1.TypeChecker.html#1360" class="Bound">t</a> <a id="1499" href="V1.TypeChecker.html#1461" class="Bound">t&#39;≢t</a><a id="1503" class="Symbol">)</a>

  <a id="1508" class="Comment">-- Operators.</a>

  <a id="inferOp"></a><a id="1525" href="V1.TypeChecker.html#1525" class="Function">inferOp</a> <a id="1533" class="Symbol">:</a> <a id="1535" class="Symbol">∀{</a><a id="1537" href="V1.TypeChecker.html#1537" class="Bound">t</a> <a id="1539" href="V1.TypeChecker.html#1539" class="Bound">t&#39;</a><a id="1541" class="Symbol">}</a> <a id="1543" class="Symbol">(</a><a id="1544" href="V1.TypeChecker.html#1544" class="Bound">op</a> <a id="1547" class="Symbol">:</a> <a id="1549" href="V1.WellTypedSyntax.html#211" class="Datatype">Op</a> <a id="1552" href="V1.TypeChecker.html#1537" class="Bound">t</a> <a id="1554" href="V1.TypeChecker.html#1539" class="Bound">t&#39;</a><a id="1556" class="Symbol">)</a> <a id="1558" class="Symbol">(</a><a id="1559" href="V1.TypeChecker.html#1559" class="Bound">e₁</a> <a id="1562" href="V1.TypeChecker.html#1562" class="Bound">e₂</a> <a id="1565" class="Symbol">:</a> <a id="1567" href="V1.AST.html#494" class="Datatype">A.Exp</a><a id="1572" class="Symbol">)</a> <a id="1574" class="Symbol">→</a> <a id="1576" href="Library.Error.html#170" class="Function">Error</a> <a id="1582" class="Symbol">(</a><a id="1583" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="1585" href="V1.AST.html#282" class="Datatype">Type</a> <a id="1590" class="Symbol">(λ</a> <a id="1593" href="V1.TypeChecker.html#1593" class="Bound">t</a> <a id="1595" class="Symbol">→</a> <a id="1597" href="V1.WellTypedSyntax.html#367" class="Datatype">Exp</a> <a id="1601" href="V1.TypeChecker.html#1593" class="Bound">t</a><a id="1602" class="Symbol">))</a>
  <a id="1607" href="V1.TypeChecker.html#1525" class="Function">inferOp</a> <a id="1615" class="Symbol">{</a><a id="1616" href="V1.TypeChecker.html#1616" class="Bound">t</a><a id="1617" class="Symbol">}</a> <a id="1619" class="Symbol">{</a><a id="1620" href="V1.TypeChecker.html#1620" class="Bound">t&#39;</a><a id="1622" class="Symbol">}</a> <a id="1624" href="V1.TypeChecker.html#1624" class="Bound">op</a> <a id="1627" href="V1.TypeChecker.html#1627" class="Bound">e₁</a> <a id="1630" href="V1.TypeChecker.html#1630" class="Bound">e₂</a> <a id="1633" class="Symbol">=</a> <a id="1635" class="Keyword">do</a>
    <a id="1642" href="V1.TypeChecker.html#1642" class="Bound">e₁&#39;</a> <a id="1646" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1648" href="V1.TypeChecker.html#1297" class="Function">checkExp</a> <a id="1657" href="V1.TypeChecker.html#1627" class="Bound">e₁</a> <a id="1660" href="V1.TypeChecker.html#1616" class="Bound">t</a>
    <a id="1666" href="V1.TypeChecker.html#1666" class="Bound">e₂&#39;</a> <a id="1670" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1672" href="V1.TypeChecker.html#1297" class="Function">checkExp</a> <a id="1681" href="V1.TypeChecker.html#1630" class="Bound">e₂</a> <a id="1684" href="V1.TypeChecker.html#1616" class="Bound">t</a>
    <a id="1690" href="Library.Monad.html#1110" class="Function">return</a> <a id="1697" class="Symbol">(</a><a id="1698" href="V1.TypeChecker.html#1620" class="Bound">t&#39;</a> <a id="1701" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1703" href="V1.WellTypedSyntax.html#540" class="InductiveConstructor">eOp</a> <a id="1707" href="V1.TypeChecker.html#1624" class="Bound">op</a> <a id="1710" href="V1.TypeChecker.html#1642" class="Bound">e₁&#39;</a> <a id="1714" href="V1.TypeChecker.html#1666" class="Bound">e₂&#39;</a><a id="1717" class="Symbol">)</a>

<a id="1720" class="Comment">-- Checking the program.</a>
<a id="1745" class="Comment">---------------------------------------------------------------------------</a>

<a id="checkProgram"></a><a id="1822" href="V1.TypeChecker.html#1822" class="Function">checkProgram</a> <a id="1835" class="Symbol">:</a> <a id="1837" class="Symbol">(</a><a id="1838" href="V1.TypeChecker.html#1838" class="Bound">prg</a> <a id="1842" class="Symbol">:</a> <a id="1844" href="V1.AST.html#784" class="Record">A.Program</a><a id="1853" class="Symbol">)</a> <a id="1855" class="Symbol">→</a> <a id="1857" href="Library.Error.html#170" class="Function">Error</a> <a id="1863" href="V1.WellTypedSyntax.html#654" class="Record">Program</a>
<a id="1871" href="V1.TypeChecker.html#1822" class="Function">checkProgram</a> <a id="1884" class="Symbol">(</a><a id="1885" href="V1.AST.html#818" class="InductiveConstructor">A.program</a> <a id="1895" href="V1.TypeChecker.html#1895" class="Bound">e</a><a id="1896" class="Symbol">)</a> <a id="1898" class="Symbol">=</a> <a id="1900" class="Keyword">do</a>
  <a id="1905" href="V1.TypeChecker.html#1905" class="Bound">e&#39;</a> <a id="1908" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1910" href="V1.TypeChecker.html#1297" class="Function">checkExp</a> <a id="1919" href="V1.TypeChecker.html#1895" class="Bound">e</a> <a id="1921" href="V1.AST.html#306" class="InductiveConstructor">int</a>
  <a id="1927" href="Library.Monad.html#1110" class="Function">return</a> <a id="1934" href="Function.html#1645" class="Function Operator">$</a> <a id="1936" href="V1.WellTypedSyntax.html#688" class="InductiveConstructor">program</a> <a id="1944" href="V1.TypeChecker.html#1905" class="Bound">e&#39;</a>


<a id="1949" class="Comment">-- -}</a>
<a id="1955" class="Comment">-- -}</a>
<a id="1961" class="Comment">-- -}</a>
<a id="1967" class="Comment">-- -}</a>
<a id="1973" class="Comment">-- -}</a>
<a id="1979" class="Comment">-- -}</a>
</pre></body></html>