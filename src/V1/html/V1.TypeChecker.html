<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>V1.TypeChecker</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Type checker for the WHILE language.</a>

<a id="42" class="Symbol">{-#</a> <a id="46" class="Keyword">OPTIONS</a> <a id="54" class="Pragma">--postfix-projections</a> <a id="76" class="Symbol">#-}</a>

<a id="81" class="Keyword">module</a> <a id="88" href="V1.TypeChecker.html" class="Module">V1.TypeChecker</a> <a id="103" class="Keyword">where</a>

<a id="110" class="Keyword">open</a> <a id="115" class="Keyword">import</a> <a id="122" href="Library.html" class="Module">Library</a>

<a id="131" class="Keyword">import</a> <a id="138" href="V1.AST.html" class="Module">V1.AST</a> <a id="145" class="Symbol">as</a> <a id="148" class="Module">A</a>
<a id="150" class="Keyword">open</a> <a id="155" class="Keyword">import</a> <a id="162" href="V1.WellTypedSyntax.html" class="Module">V1.WellTypedSyntax</a>

<a id="182" class="Comment">-- Type errors.</a>
<a id="198" class="Comment">--</a>
<a id="201" class="Comment">-- Currently, these errors do not carry enough evidence that</a>
<a id="262" class="Comment">-- something is wrong.  The type checker does not produce</a>
<a id="320" class="Comment">-- evidence of ill-typedness in case of failure,</a>
<a id="369" class="Comment">-- only of well-typedness in case of success.</a>

<a id="416" class="Keyword">data</a> <a id="TypeError"></a><a id="421" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a> <a id="431" class="Symbol">:</a> <a id="433" class="PrimitiveType">Set</a> <a id="437" class="Keyword">where</a>
  <a id="TypeError.typeMismatch"></a><a id="445" href="V1.TypeChecker.html#445" class="InductiveConstructor">typeMismatch</a> <a id="458" class="Symbol">:</a> <a id="460" class="Symbol">(</a><a id="461" href="V1.TypeChecker.html#461" class="Bound">tinf</a> <a id="466" href="V1.TypeChecker.html#466" class="Bound">texp</a> <a id="471" class="Symbol">:</a> <a id="473" href="V1.AST.html#282" class="Datatype">Type</a><a id="477" class="Symbol">)</a>  <a id="480" class="Symbol">→</a> <a id="482" href="V1.TypeChecker.html#461" class="Bound">tinf</a> <a id="487" href="Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">≢</a> <a id="489" href="V1.TypeChecker.html#466" class="Bound">texp</a> <a id="494" class="Symbol">→</a> <a id="496" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a>

<a id="507" class="Keyword">instance</a>
  <a id="PrintError"></a><a id="518" href="V1.TypeChecker.html#518" class="Function">PrintError</a> <a id="529" class="Symbol">:</a> <a id="531" href="Library.Print.html#196" class="Record">Print</a> <a id="537" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a>
  <a id="549" href="Library.Print.html#244" class="Field">print</a> <a id="555" class="Symbol">{{</a><a id="557" href="V1.TypeChecker.html#518" class="Function">PrintError</a><a id="567" class="Symbol">}}</a> <a id="570" class="Symbol">=</a> <a id="572" class="Symbol">λ</a> <a id="574" class="Keyword">where</a>
    <a id="584" class="Symbol">(</a><a id="585" href="V1.TypeChecker.html#445" class="InductiveConstructor">typeMismatch</a> <a id="598" href="V1.TypeChecker.html#598" class="Bound">tinf</a> <a id="603" href="V1.TypeChecker.html#603" class="Bound">texp</a> <a id="608" class="Symbol">_)</a> <a id="611" class="Symbol">→</a> <a id="613" href="Data.String.Base.html#1932" class="Function">String.concat</a> <a id="627" href="Function.html#1645" class="Function Operator">$</a>
      <a id="635" class="String">&quot;type mismatch: expected &quot;</a> <a id="662" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="664" href="Library.Print.html#244" class="Field">print</a> <a id="670" href="V1.TypeChecker.html#603" class="Bound">texp</a> <a id="675" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a>
      <a id="683" class="String">&quot;, but inferred &quot;</a> <a id="701" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="703" href="Library.Print.html#244" class="Field">print</a> <a id="709" href="V1.TypeChecker.html#598" class="Bound">tinf</a> <a id="714" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="716" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a>

<a id="720" class="Comment">-- Type error monad.</a>

<a id="742" class="Keyword">open</a> <a id="747" href="Library.Error.html#134" class="Module">ErrorMonad</a> <a id="758" class="Symbol">{</a><a id="759" class="Argument">E</a> <a id="761" class="Symbol">=</a> <a id="763" href="V1.TypeChecker.html#421" class="Datatype">TypeError</a><a id="772" class="Symbol">}</a>

<a id="775" class="Comment">-- Checking expressions</a>
<a id="799" class="Comment">---------------------------------------------------------------------------</a>

<a id="876" class="Keyword">mutual</a>

  <a id="886" class="Comment">-- Type inference.</a>

  <a id="inferExp"></a><a id="908" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="917" class="Symbol">:</a> <a id="919" class="Symbol">(</a><a id="920" href="V1.TypeChecker.html#920" class="Bound">e</a> <a id="922" class="Symbol">:</a> <a id="924" href="V1.AST.html#494" class="Datatype">A.Exp</a><a id="929" class="Symbol">)</a> <a id="931" class="Symbol">→</a> <a id="933" href="Library.Error.html#170" class="Function">Error</a> <a id="939" class="Symbol">(</a><a id="940" href="Data.Product.html#1364" class="Function">∃</a> <a id="942" class="Symbol">λ</a> <a id="944" class="Symbol">(</a><a id="945" href="V1.TypeChecker.html#945" class="Bound">t</a> <a id="947" class="Symbol">:</a> <a id="949" href="V1.AST.html#282" class="Datatype">Type</a><a id="953" class="Symbol">)</a> <a id="955" class="Symbol">→</a> <a id="957" href="V1.WellTypedSyntax.html#367" class="Datatype">Exp</a> <a id="961" href="V1.TypeChecker.html#945" class="Bound">t</a><a id="962" class="Symbol">)</a>
  <a id="966" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="975" class="Symbol">(</a><a id="976" href="V1.AST.html#512" class="InductiveConstructor">A.eInt</a> <a id="983" href="V1.TypeChecker.html#983" class="Bound">i</a><a id="984" class="Symbol">)</a>  <a id="987" class="Symbol">=</a> <a id="989" href="Library.Monad.html#1110" class="Function">return</a> <a id="996" class="Symbol">(</a><a id="997" href="V1.AST.html#306" class="InductiveConstructor">int</a>  <a id="1002" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1004" href="V1.WellTypedSyntax.html#407" class="InductiveConstructor">eInt</a>  <a id="1010" href="V1.TypeChecker.html#983" class="Bound">i</a><a id="1011" class="Symbol">)</a>
  <a id="1015" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1024" class="Symbol">(</a><a id="1025" href="V1.AST.html#557" class="InductiveConstructor">A.eBool</a> <a id="1033" href="V1.TypeChecker.html#1033" class="Bound">b</a><a id="1034" class="Symbol">)</a> <a id="1036" class="Symbol">=</a> <a id="1038" href="Library.Monad.html#1110" class="Function">return</a> <a id="1045" class="Symbol">(</a><a id="1046" href="V1.AST.html#301" class="InductiveConstructor">bool</a> <a id="1051" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1053" href="V1.WellTypedSyntax.html#465" class="InductiveConstructor">eBool</a> <a id="1059" href="V1.TypeChecker.html#1033" class="Bound">b</a><a id="1060" class="Symbol">)</a>
  <a id="1064" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1073" class="Symbol">(</a><a id="1074" href="V1.AST.html#602" class="InductiveConstructor">A.ePlus</a> <a id="1082" href="V1.TypeChecker.html#1082" class="Bound">e₁</a> <a id="1085" href="V1.TypeChecker.html#1085" class="Bound">e₂</a><a id="1087" class="Symbol">)</a> <a id="1089" class="Symbol">=</a> <a id="1091" href="V1.TypeChecker.html#1527" class="Function">inferOp</a> <a id="1099" href="V1.WellTypedSyntax.html#249" class="InductiveConstructor">plus</a>  <a id="1105" href="V1.TypeChecker.html#1082" class="Bound">e₁</a> <a id="1108" href="V1.TypeChecker.html#1085" class="Bound">e₂</a>
  <a id="1113" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1122" class="Symbol">(</a><a id="1123" href="V1.AST.html#647" class="InductiveConstructor">A.eGt</a>   <a id="1131" href="V1.TypeChecker.html#1131" class="Bound">e₁</a> <a id="1134" href="V1.TypeChecker.html#1134" class="Bound">e₂</a><a id="1136" class="Symbol">)</a> <a id="1138" class="Symbol">=</a> <a id="1140" href="V1.TypeChecker.html#1527" class="Function">inferOp</a> <a id="1148" href="V1.WellTypedSyntax.html#271" class="InductiveConstructor">gt</a>    <a id="1154" href="V1.TypeChecker.html#1131" class="Bound">e₁</a> <a id="1157" href="V1.TypeChecker.html#1134" class="Bound">e₂</a>
  <a id="1162" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1171" class="Symbol">(</a><a id="1172" href="V1.AST.html#692" class="InductiveConstructor">A.eAnd</a>  <a id="1180" href="V1.TypeChecker.html#1180" class="Bound">e₁</a> <a id="1183" href="V1.TypeChecker.html#1183" class="Bound">e₂</a><a id="1185" class="Symbol">)</a> <a id="1187" class="Symbol">=</a> <a id="1189" href="V1.TypeChecker.html#1527" class="Function">inferOp</a> <a id="1197" href="V1.WellTypedSyntax.html#294" class="InductiveConstructor">and</a>   <a id="1203" href="V1.TypeChecker.html#1180" class="Bound">e₁</a> <a id="1206" href="V1.TypeChecker.html#1183" class="Bound">e₂</a>

  <a id="1212" class="Comment">-- Type checking.</a>
  <a id="1232" class="Comment">-- Calls inference and checks inferred type against given type.</a>

  <a id="checkExp"></a><a id="1299" href="V1.TypeChecker.html#1299" class="Function">checkExp</a> <a id="1308" class="Symbol">:</a> <a id="1310" class="Symbol">(</a><a id="1311" href="V1.TypeChecker.html#1311" class="Bound">e</a> <a id="1313" class="Symbol">:</a> <a id="1315" href="V1.AST.html#494" class="Datatype">A.Exp</a><a id="1320" class="Symbol">)</a> <a id="1322" class="Symbol">(</a><a id="1323" href="V1.TypeChecker.html#1323" class="Bound">t</a> <a id="1325" class="Symbol">:</a> <a id="1327" href="V1.AST.html#282" class="Datatype">Type</a><a id="1331" class="Symbol">)</a> <a id="1333" class="Symbol">→</a> <a id="1335" href="Library.Error.html#170" class="Function">Error</a> <a id="1341" class="Symbol">(</a><a id="1342" href="V1.WellTypedSyntax.html#367" class="Datatype">Exp</a> <a id="1346" href="V1.TypeChecker.html#1323" class="Bound">t</a><a id="1347" class="Symbol">)</a>
  <a id="1351" href="V1.TypeChecker.html#1299" class="Function">checkExp</a> <a id="1360" href="V1.TypeChecker.html#1360" class="Bound">e</a> <a id="1362" href="V1.TypeChecker.html#1362" class="Bound">t</a> <a id="1364" class="Symbol">=</a> <a id="1366" class="Keyword">do</a>
    <a id="1373" class="Symbol">(</a><a id="1374" href="V1.TypeChecker.html#1374" class="Bound">t&#39;</a> <a id="1377" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1379" href="V1.TypeChecker.html#1379" class="Bound">e&#39;</a><a id="1381" class="Symbol">)</a> <a id="1383" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1385" href="V1.TypeChecker.html#908" class="Function">inferExp</a> <a id="1394" href="V1.TypeChecker.html#1360" class="Bound">e</a>
    <a id="1400" href="Function.html#3662" class="Function Operator">case</a> <a id="1405" href="V1.TypeChecker.html#1374" class="Bound">t&#39;</a> <a id="1408" href="Library.Eq.html#627" class="Field Operator">≟</a> <a id="1410" href="V1.TypeChecker.html#1362" class="Bound">t</a> <a id="1412" href="Function.html#3662" class="Function Operator">of</a> <a id="1415" class="Symbol">λ</a> <a id="1417" class="Keyword">where</a>
      <a id="1429" class="Symbol">(</a><a id="1430" href="Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="1434" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1438" class="Symbol">)</a> <a id="1440" class="Symbol">→</a> <a id="1442" href="Library.Monad.html#1110" class="Function">return</a> <a id="1449" href="V1.TypeChecker.html#1379" class="Bound">e&#39;</a>
      <a id="1458" class="Symbol">(</a><a id="1459" href="Relation.Nullary.html#668" class="InductiveConstructor">no</a>  <a id="1463" href="V1.TypeChecker.html#1463" class="Bound">t&#39;≢t</a><a id="1467" class="Symbol">)</a> <a id="1469" class="Symbol">→</a> <a id="1471" href="Library.Error.html#912" class="Function">throwError</a> <a id="1482" class="Symbol">(</a><a id="1483" href="V1.TypeChecker.html#445" class="InductiveConstructor">typeMismatch</a> <a id="1496" href="V1.TypeChecker.html#1374" class="Bound">t&#39;</a> <a id="1499" href="V1.TypeChecker.html#1362" class="Bound">t</a> <a id="1501" href="V1.TypeChecker.html#1463" class="Bound">t&#39;≢t</a><a id="1505" class="Symbol">)</a>

  <a id="1510" class="Comment">-- Operators.</a>

  <a id="inferOp"></a><a id="1527" href="V1.TypeChecker.html#1527" class="Function">inferOp</a> <a id="1535" class="Symbol">:</a> <a id="1537" class="Symbol">∀{</a><a id="1539" href="V1.TypeChecker.html#1539" class="Bound">t</a> <a id="1541" href="V1.TypeChecker.html#1541" class="Bound">t&#39;</a><a id="1543" class="Symbol">}</a> <a id="1545" class="Symbol">(</a><a id="1546" href="V1.TypeChecker.html#1546" class="Bound">op</a> <a id="1549" class="Symbol">:</a> <a id="1551" href="V1.WellTypedSyntax.html#211" class="Datatype">Op</a> <a id="1554" href="V1.TypeChecker.html#1539" class="Bound">t</a> <a id="1556" href="V1.TypeChecker.html#1541" class="Bound">t&#39;</a><a id="1558" class="Symbol">)</a> <a id="1560" class="Symbol">(</a><a id="1561" href="V1.TypeChecker.html#1561" class="Bound">e₁</a> <a id="1564" href="V1.TypeChecker.html#1564" class="Bound">e₂</a> <a id="1567" class="Symbol">:</a> <a id="1569" href="V1.AST.html#494" class="Datatype">A.Exp</a><a id="1574" class="Symbol">)</a> <a id="1576" class="Symbol">→</a> <a id="1578" href="Library.Error.html#170" class="Function">Error</a> <a id="1584" class="Symbol">(</a><a id="1585" href="Data.Product.html#1364" class="Function">∃</a> <a id="1587" class="Symbol">λ</a> <a id="1589" href="V1.TypeChecker.html#1589" class="Bound">t</a> <a id="1591" class="Symbol">→</a> <a id="1593" href="V1.WellTypedSyntax.html#367" class="Datatype">Exp</a> <a id="1597" href="V1.TypeChecker.html#1589" class="Bound">t</a><a id="1598" class="Symbol">)</a>
  <a id="1602" href="V1.TypeChecker.html#1527" class="Function">inferOp</a> <a id="1610" class="Symbol">{</a><a id="1611" href="V1.TypeChecker.html#1611" class="Bound">t</a><a id="1612" class="Symbol">}</a> <a id="1614" class="Symbol">{</a><a id="1615" href="V1.TypeChecker.html#1615" class="Bound">t&#39;</a><a id="1617" class="Symbol">}</a> <a id="1619" href="V1.TypeChecker.html#1619" class="Bound">op</a> <a id="1622" href="V1.TypeChecker.html#1622" class="Bound">e₁</a> <a id="1625" href="V1.TypeChecker.html#1625" class="Bound">e₂</a> <a id="1628" class="Symbol">=</a> <a id="1630" class="Keyword">do</a>
    <a id="1637" href="V1.TypeChecker.html#1637" class="Bound">e₁&#39;</a> <a id="1641" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1643" href="V1.TypeChecker.html#1299" class="Function">checkExp</a> <a id="1652" href="V1.TypeChecker.html#1622" class="Bound">e₁</a> <a id="1655" href="V1.TypeChecker.html#1611" class="Bound">t</a>
    <a id="1661" href="V1.TypeChecker.html#1661" class="Bound">e₂&#39;</a> <a id="1665" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1667" href="V1.TypeChecker.html#1299" class="Function">checkExp</a> <a id="1676" href="V1.TypeChecker.html#1625" class="Bound">e₂</a> <a id="1679" href="V1.TypeChecker.html#1611" class="Bound">t</a>
    <a id="1685" href="Library.Monad.html#1110" class="Function">return</a> <a id="1692" class="Symbol">(</a><a id="1693" href="V1.TypeChecker.html#1615" class="Bound">t&#39;</a> <a id="1696" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1698" href="V1.WellTypedSyntax.html#540" class="InductiveConstructor">eOp</a> <a id="1702" href="V1.TypeChecker.html#1619" class="Bound">op</a> <a id="1705" href="V1.TypeChecker.html#1637" class="Bound">e₁&#39;</a> <a id="1709" href="V1.TypeChecker.html#1661" class="Bound">e₂&#39;</a><a id="1712" class="Symbol">)</a>

<a id="1715" class="Comment">-- Checking the program.</a>
<a id="1740" class="Comment">---------------------------------------------------------------------------</a>

<a id="checkProgram"></a><a id="1817" href="V1.TypeChecker.html#1817" class="Function">checkProgram</a> <a id="1830" class="Symbol">:</a> <a id="1832" class="Symbol">(</a><a id="1833" href="V1.TypeChecker.html#1833" class="Bound">prg</a> <a id="1837" class="Symbol">:</a> <a id="1839" href="V1.AST.html#830" class="Record">A.Program</a><a id="1848" class="Symbol">)</a> <a id="1850" class="Symbol">→</a> <a id="1852" href="Library.Error.html#170" class="Function">Error</a> <a id="1858" href="V1.WellTypedSyntax.html#654" class="Record">Program</a>
<a id="1866" href="V1.TypeChecker.html#1817" class="Function">checkProgram</a> <a id="1879" class="Symbol">(</a><a id="1880" href="V1.AST.html#864" class="InductiveConstructor">A.program</a> <a id="1890" href="V1.TypeChecker.html#1890" class="Bound">e</a><a id="1891" class="Symbol">)</a> <a id="1893" class="Symbol">=</a> <a id="1895" class="Keyword">do</a>
  <a id="1900" href="V1.TypeChecker.html#1900" class="Bound">e&#39;</a> <a id="1903" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1905" href="V1.TypeChecker.html#1299" class="Function">checkExp</a> <a id="1914" href="V1.TypeChecker.html#1890" class="Bound">e</a> <a id="1916" href="V1.AST.html#306" class="InductiveConstructor">int</a>
  <a id="1922" href="Library.Monad.html#1110" class="Function">return</a> <a id="1929" href="Function.html#1645" class="Function Operator">$</a> <a id="1931" href="V1.WellTypedSyntax.html#688" class="InductiveConstructor">program</a> <a id="1939" href="V1.TypeChecker.html#1900" class="Bound">e&#39;</a>


<a id="1944" class="Comment">-- -}</a>
<a id="1950" class="Comment">-- -}</a>
<a id="1956" class="Comment">-- -}</a>
<a id="1962" class="Comment">-- -}</a>
<a id="1968" class="Comment">-- -}</a>
<a id="1974" class="Comment">-- -}</a>
</pre></body></html>