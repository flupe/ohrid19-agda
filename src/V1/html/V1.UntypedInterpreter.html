<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>V1.UntypedInterpreter</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Untyped interpreter for the WHILE language.</a>
<a id="48" class="Comment">--</a>
<a id="51" class="Comment">-- * Runs directly on the unchecked abstract syntax tree.</a>
<a id="109" class="Comment">-- * May fail due to scope and other runtime errors.</a>
<a id="162" class="Comment">-- * while loops may not terminate.</a>

<a id="199" class="Keyword">module</a> <a id="206" href="V1.UntypedInterpreter.html" class="Module">V1.UntypedInterpreter</a> <a id="228" class="Keyword">where</a>

<a id="235" class="Keyword">open</a> <a id="240" class="Keyword">import</a> <a id="247" href="Library.html" class="Module">Library</a>
<a id="255" class="Keyword">open</a> <a id="260" class="Keyword">import</a> <a id="267" href="V1.AST.html" class="Module">V1.AST</a>

<a id="275" class="Comment">-- Untyped values.</a>

<a id="295" class="Keyword">data</a> <a id="Val"></a><a id="300" href="V1.UntypedInterpreter.html#300" class="Datatype">Val</a> <a id="304" class="Symbol">:</a> <a id="306" class="PrimitiveType">Set</a> <a id="310" class="Keyword">where</a>
  <a id="Val.intV"></a><a id="318" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a>  <a id="324" class="Symbol">:</a> <a id="326" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a>       <a id="334" class="Symbol">→</a> <a id="336" href="V1.UntypedInterpreter.html#300" class="Datatype">Val</a>
  <a id="Val.boolV"></a><a id="342" href="V1.UntypedInterpreter.html#342" class="InductiveConstructor">boolV</a> <a id="348" class="Symbol">:</a> <a id="350" href="V1.AST.html#384" class="Datatype">Boolean</a> <a id="358" class="Symbol">→</a> <a id="360" href="V1.UntypedInterpreter.html#300" class="Datatype">Val</a>

<a id="365" class="Keyword">instance</a>
  <a id="PrintVal"></a><a id="376" href="V1.UntypedInterpreter.html#376" class="Function">PrintVal</a> <a id="385" class="Symbol">:</a> <a id="387" href="Library.Print.html#196" class="Record">Print</a> <a id="393" href="V1.UntypedInterpreter.html#300" class="Datatype">Val</a>
  <a id="399" href="Library.Print.html#244" class="Field">print</a> <a id="405" class="Symbol">{{</a><a id="407" href="V1.UntypedInterpreter.html#376" class="Function">PrintVal</a><a id="415" class="Symbol">}}</a> <a id="418" class="Symbol">=</a> <a id="420" class="Symbol">λ</a> <a id="422" class="Keyword">where</a>
    <a id="432" class="Symbol">(</a><a id="433" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="438" href="V1.UntypedInterpreter.html#438" class="Bound">i</a><a id="439" class="Symbol">)</a>  <a id="442" class="Symbol">→</a> <a id="444" href="Library.Print.html#244" class="Field">print</a> <a id="450" href="V1.UntypedInterpreter.html#438" class="Bound">i</a>
    <a id="456" class="Symbol">(</a><a id="457" href="V1.UntypedInterpreter.html#342" class="InductiveConstructor">boolV</a> <a id="463" href="V1.UntypedInterpreter.html#463" class="Bound">b</a><a id="464" class="Symbol">)</a> <a id="466" class="Symbol">→</a> <a id="468" href="Library.Print.html#244" class="Field">print</a> <a id="474" href="V1.UntypedInterpreter.html#463" class="Bound">b</a>

<a id="477" class="Comment">-- Semantics of operations.</a>

<a id="506" class="Comment">-- Boolean negation.</a>

<a id="bNot"></a><a id="528" href="V1.UntypedInterpreter.html#528" class="Function">bNot</a> <a id="533" class="Symbol">:</a> <a id="535" href="V1.AST.html#384" class="Datatype">Boolean</a> <a id="543" class="Symbol">→</a> <a id="545" href="V1.AST.html#384" class="Datatype">Boolean</a>
<a id="553" href="V1.UntypedInterpreter.html#528" class="Function">bNot</a> <a id="558" href="V1.AST.html#406" class="InductiveConstructor">true</a> <a id="563" class="Symbol">=</a> <a id="565" href="V1.AST.html#411" class="InductiveConstructor">false</a>
<a id="571" href="V1.UntypedInterpreter.html#528" class="Function">bNot</a> <a id="576" href="V1.AST.html#411" class="InductiveConstructor">false</a> <a id="582" class="Symbol">=</a> <a id="584" href="V1.AST.html#406" class="InductiveConstructor">true</a>

<a id="590" class="Comment">-- Boolean conjunction.</a>

<a id="bAnd"></a><a id="615" href="V1.UntypedInterpreter.html#615" class="Function">bAnd</a> <a id="620" class="Symbol">:</a> <a id="622" href="V1.AST.html#384" class="Datatype">Boolean</a> <a id="630" class="Symbol">→</a> <a id="632" href="V1.AST.html#384" class="Datatype">Boolean</a> <a id="640" class="Symbol">→</a> <a id="642" href="V1.AST.html#384" class="Datatype">Boolean</a>
<a id="650" href="V1.UntypedInterpreter.html#615" class="Function">bAnd</a> <a id="655" href="V1.AST.html#406" class="InductiveConstructor">true</a>  <a id="661" href="V1.UntypedInterpreter.html#661" class="Bound">b</a> <a id="663" class="Symbol">=</a> <a id="665" href="V1.UntypedInterpreter.html#661" class="Bound">b</a>
<a id="667" href="V1.UntypedInterpreter.html#615" class="Function">bAnd</a> <a id="672" href="V1.AST.html#411" class="InductiveConstructor">false</a> <a id="678" class="Symbol">_</a> <a id="680" class="Symbol">=</a> <a id="682" href="V1.AST.html#411" class="InductiveConstructor">false</a>

<a id="689" class="Comment">-- Greater-than on integers.</a>

<a id="iGt"></a><a id="719" href="V1.UntypedInterpreter.html#719" class="Function">iGt</a> <a id="723" class="Symbol">:</a> <a id="725" class="Symbol">(</a><a id="726" href="V1.UntypedInterpreter.html#726" class="Bound">i</a> <a id="728" href="V1.UntypedInterpreter.html#728" class="Bound">j</a> <a id="730" class="Symbol">:</a> <a id="732" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a><a id="733" class="Symbol">)</a> <a id="735" class="Symbol">→</a> <a id="737" href="V1.AST.html#384" class="Datatype">Boolean</a>
<a id="745" href="V1.UntypedInterpreter.html#719" class="Function">iGt</a> <a id="749" href="V1.UntypedInterpreter.html#749" class="Bound">i</a> <a id="751" href="V1.UntypedInterpreter.html#751" class="Bound">j</a> <a id="753" class="Symbol">=</a> <a id="755" href="Function.html#3662" class="Function Operator">case</a> <a id="760" href="V1.UntypedInterpreter.html#749" class="Bound">i</a> <a id="762" href="Library.html#2213" class="Function Operator">Integer.&lt;=</a> <a id="773" href="V1.UntypedInterpreter.html#751" class="Bound">j</a> <a id="775" href="Function.html#3662" class="Function Operator">of</a> <a id="778" class="Symbol">λ</a> <a id="780" class="Keyword">where</a>
  <a id="788" href="Agda.Builtin.Bool.html#154" class="InductiveConstructor">false</a> <a id="794" class="Symbol">→</a> <a id="796" href="V1.AST.html#406" class="InductiveConstructor">true</a>
  <a id="803" href="Agda.Builtin.Bool.html#160" class="InductiveConstructor">true</a>  <a id="809" class="Symbol">→</a> <a id="811" href="V1.AST.html#411" class="InductiveConstructor">false</a>

<a id="818" class="Comment">-- Evaluation of expressions.  The environment is fixed.</a>

<a id="876" class="Comment">-- Evaluation may fail due to type errors, thus eval is partial.</a>
<a id="941" class="Comment">-- E.g. eval (eNot (eInt zero)) ≡ nothing.</a>

<a id="eval"></a><a id="985" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="990" class="Symbol">:</a> <a id="992" href="V1.AST.html#494" class="Datatype">Exp</a> <a id="996" class="Symbol">→</a> <a id="998" href="Data.Maybe.Base.html#795" class="Datatype">Maybe</a> <a id="1004" href="V1.UntypedInterpreter.html#300" class="Datatype">Val</a>
<a id="1008" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1013" class="Symbol">(</a><a id="1014" href="V1.AST.html#512" class="InductiveConstructor">eInt</a> <a id="1019" href="V1.UntypedInterpreter.html#1019" class="Bound">i</a><a id="1020" class="Symbol">)</a>  <a id="1023" class="Symbol">=</a> <a id="1025" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1030" class="Symbol">(</a><a id="1031" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="1036" href="V1.UntypedInterpreter.html#1019" class="Bound">i</a><a id="1037" class="Symbol">)</a>
<a id="1039" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1044" class="Symbol">(</a><a id="1045" href="V1.AST.html#543" class="InductiveConstructor">eBool</a> <a id="1051" href="V1.UntypedInterpreter.html#1051" class="Bound">b</a><a id="1052" class="Symbol">)</a> <a id="1054" class="Symbol">=</a> <a id="1056" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1061" class="Symbol">(</a><a id="1062" href="V1.UntypedInterpreter.html#342" class="InductiveConstructor">boolV</a> <a id="1068" href="V1.UntypedInterpreter.html#1051" class="Bound">b</a><a id="1069" class="Symbol">)</a>
<a id="1071" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1076" class="Symbol">(</a><a id="1077" href="V1.AST.html#574" class="InductiveConstructor">ePlus</a> <a id="1083" href="V1.UntypedInterpreter.html#1083" class="Bound">e₁</a> <a id="1086" href="V1.UntypedInterpreter.html#1086" class="Bound">e₂</a><a id="1088" class="Symbol">)</a> <a id="1090" class="Symbol">=</a> <a id="1092" href="Function.html#3662" class="Function Operator">case</a> <a id="1097" class="Symbol">(</a><a id="1098" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1103" href="V1.UntypedInterpreter.html#1083" class="Bound">e₁</a> <a id="1106" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1108" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1113" href="V1.UntypedInterpreter.html#1086" class="Bound">e₂</a><a id="1115" class="Symbol">)</a> <a id="1117" href="Function.html#3662" class="Function Operator">of</a> <a id="1120" class="Symbol">λ</a> <a id="1122" class="Keyword">where</a>
  <a id="1130" class="Symbol">(</a><a id="1131" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1136" class="Symbol">(</a><a id="1137" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="1142" href="V1.UntypedInterpreter.html#1142" class="Bound">i</a><a id="1143" class="Symbol">)</a> <a id="1145" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1147" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1152" class="Symbol">(</a><a id="1153" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="1158" href="V1.UntypedInterpreter.html#1158" class="Bound">j</a><a id="1159" class="Symbol">))</a> <a id="1162" class="Symbol">→</a> <a id="1164" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1169" class="Symbol">(</a><a id="1170" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="1175" class="Symbol">(</a><a id="1176" href="V1.UntypedInterpreter.html#1142" class="Bound">i</a> <a id="1178" href="Data.Integer.Base.html#2950" class="Function Operator">+</a> <a id="1180" href="V1.UntypedInterpreter.html#1158" class="Bound">j</a><a id="1181" class="Symbol">))</a>
  <a id="1186" class="CatchallClause Symbol">_</a> <a id="1188" class="Symbol">→</a> <a id="1190" href="Data.Maybe.Base.html#859" class="InductiveConstructor">nothing</a>
<a id="1198" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1203" class="Symbol">(</a><a id="1204" href="V1.AST.html#605" class="InductiveConstructor">eGt</a> <a id="1208" href="V1.UntypedInterpreter.html#1208" class="Bound">e₁</a> <a id="1211" href="V1.UntypedInterpreter.html#1211" class="Bound">e₂</a><a id="1213" class="Symbol">)</a> <a id="1215" class="Symbol">=</a> <a id="1217" href="Function.html#3662" class="Function Operator">case</a> <a id="1222" class="Symbol">(</a><a id="1223" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1228" href="V1.UntypedInterpreter.html#1208" class="Bound">e₁</a> <a id="1231" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1233" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1238" href="V1.UntypedInterpreter.html#1211" class="Bound">e₂</a><a id="1240" class="Symbol">)</a> <a id="1242" href="Function.html#3662" class="Function Operator">of</a> <a id="1245" class="Symbol">λ</a> <a id="1247" class="Keyword">where</a>
  <a id="1255" class="Symbol">(</a><a id="1256" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1261" class="Symbol">(</a><a id="1262" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="1267" href="V1.UntypedInterpreter.html#1267" class="Bound">i</a><a id="1268" class="Symbol">)</a> <a id="1270" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1272" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1277" class="Symbol">(</a><a id="1278" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="1283" href="V1.UntypedInterpreter.html#1283" class="Bound">j</a><a id="1284" class="Symbol">))</a> <a id="1287" class="Symbol">→</a> <a id="1289" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1294" class="Symbol">(</a><a id="1295" href="V1.UntypedInterpreter.html#342" class="InductiveConstructor">boolV</a> <a id="1301" class="Symbol">(</a><a id="1302" href="V1.UntypedInterpreter.html#719" class="Function">iGt</a> <a id="1306" href="V1.UntypedInterpreter.html#1267" class="Bound">i</a> <a id="1308" href="V1.UntypedInterpreter.html#1283" class="Bound">j</a><a id="1309" class="Symbol">))</a>
  <a id="1314" class="CatchallClause Symbol">_</a> <a id="1316" class="Symbol">→</a> <a id="1318" href="Data.Maybe.Base.html#859" class="InductiveConstructor">nothing</a>
<a id="1326" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1331" class="Symbol">(</a><a id="1332" href="V1.AST.html#636" class="InductiveConstructor">eAnd</a> <a id="1337" href="V1.UntypedInterpreter.html#1337" class="Bound">e₁</a> <a id="1340" href="V1.UntypedInterpreter.html#1340" class="Bound">e₂</a><a id="1342" class="Symbol">)</a> <a id="1344" class="Symbol">=</a> <a id="1346" href="Function.html#3662" class="Function Operator">case</a> <a id="1351" class="Symbol">(</a><a id="1352" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1357" href="V1.UntypedInterpreter.html#1337" class="Bound">e₁</a> <a id="1360" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1362" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1367" href="V1.UntypedInterpreter.html#1340" class="Bound">e₂</a><a id="1369" class="Symbol">)</a> <a id="1371" href="Function.html#3662" class="Function Operator">of</a> <a id="1374" class="Symbol">λ</a> <a id="1376" class="Keyword">where</a>
  <a id="1384" class="Symbol">(</a><a id="1385" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1390" class="Symbol">(</a><a id="1391" href="V1.UntypedInterpreter.html#342" class="InductiveConstructor">boolV</a> <a id="1397" href="V1.UntypedInterpreter.html#1397" class="Bound">b₁</a><a id="1399" class="Symbol">)</a> <a id="1401" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1403" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1408" class="Symbol">(</a><a id="1409" href="V1.UntypedInterpreter.html#342" class="InductiveConstructor">boolV</a> <a id="1415" href="V1.UntypedInterpreter.html#1415" class="Bound">b₂</a><a id="1417" class="Symbol">))</a> <a id="1420" class="Symbol">→</a> <a id="1422" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1427" class="Symbol">(</a><a id="1428" href="V1.UntypedInterpreter.html#342" class="InductiveConstructor">boolV</a> <a id="1434" class="Symbol">(</a><a id="1435" href="V1.UntypedInterpreter.html#615" class="Function">bAnd</a> <a id="1440" href="V1.UntypedInterpreter.html#1397" class="Bound">b₁</a> <a id="1443" href="V1.UntypedInterpreter.html#1415" class="Bound">b₂</a><a id="1445" class="Symbol">))</a>
  <a id="1450" class="CatchallClause Symbol">_</a> <a id="1452" class="Symbol">→</a> <a id="1454" href="Data.Maybe.Base.html#859" class="InductiveConstructor">nothing</a>

<a id="evalPrg"></a><a id="1463" href="V1.UntypedInterpreter.html#1463" class="Function">evalPrg</a> <a id="1471" class="Symbol">:</a> <a id="1473" href="V1.AST.html#759" class="Record">Program</a> <a id="1481" class="Symbol">→</a> <a id="1483" href="Data.Maybe.Base.html#795" class="Datatype">Maybe</a> <a id="1489" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a>
<a id="1491" href="V1.UntypedInterpreter.html#1463" class="Function">evalPrg</a> <a id="1499" class="Symbol">(</a><a id="1500" href="V1.AST.html#793" class="InductiveConstructor">program</a> <a id="1508" href="V1.UntypedInterpreter.html#1508" class="Bound">e</a><a id="1509" class="Symbol">)</a> <a id="1511" class="Symbol">=</a> <a id="1513" href="Function.html#3662" class="Function Operator">case</a> <a id="1518" href="V1.UntypedInterpreter.html#985" class="Function">eval</a> <a id="1523" href="V1.UntypedInterpreter.html#1508" class="Bound">e</a> <a id="1525" href="Function.html#3662" class="Function Operator">of</a> <a id="1528" class="Symbol">λ</a> <a id="1530" class="Keyword">where</a>
    <a id="1540" class="Symbol">(</a><a id="1541" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1546" class="Symbol">(</a><a id="1547" href="V1.UntypedInterpreter.html#318" class="InductiveConstructor">intV</a> <a id="1552" href="V1.UntypedInterpreter.html#1552" class="Bound">v</a><a id="1553" class="Symbol">))</a> <a id="1556" class="Symbol">→</a> <a id="1558" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="1563" href="V1.UntypedInterpreter.html#1552" class="Bound">v</a>
    <a id="1569" class="CatchallClause Symbol">_</a>               <a id="1585" class="Symbol">→</a> <a id="1587" href="Data.Maybe.Base.html#859" class="InductiveConstructor">nothing</a>
</pre></body></html>