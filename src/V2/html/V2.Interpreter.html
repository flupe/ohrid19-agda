<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>V2.Interpreter</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Interpreter for WHILE language.</a>

<a id="37" class="Comment">-- As computation is not guaranteed to terminate,</a>
<a id="87" class="Comment">-- execution of statements is placed in the Delay monad.</a>

<a id="145" class="Keyword">module</a> <a id="152" href="V2.Interpreter.html" class="Module">V2.Interpreter</a> <a id="167" class="Keyword">where</a>

<a id="174" class="Keyword">open</a> <a id="179" class="Keyword">import</a> <a id="186" href="Library.html" class="Module">Library</a>
<a id="194" class="Keyword">open</a> <a id="199" class="Keyword">import</a> <a id="206" href="V2.WellTypedSyntax.html" class="Module">V2.WellTypedSyntax</a>
<a id="225" class="Keyword">open</a> <a id="230" class="Keyword">import</a> <a id="237" href="V2.Value.html" class="Module">V2.Value</a>

<a id="247" class="Comment">-- Evaluation of expressions in fixed environment ρ.</a>

<a id="301" class="Keyword">module</a> <a id="EvalExp"></a><a id="308" href="V2.Interpreter.html#308" class="Module">EvalExp</a> <a id="316" class="Symbol">{</a><a id="317" href="V2.Interpreter.html#317" class="Bound">Γ</a><a id="318" class="Symbol">}</a> <a id="320" class="Symbol">(</a><a id="321" href="V2.Interpreter.html#321" class="Bound">ρ</a> <a id="323" class="Symbol">:</a> <a id="325" href="V2.Value.html#388" class="Function">Env</a> <a id="329" href="V2.Interpreter.html#317" class="Bound">Γ</a><a id="330" class="Symbol">)</a> <a id="332" class="Keyword">where</a>

  <a id="EvalExp.eval"></a><a id="341" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="346" class="Symbol">:</a> <a id="348" class="Symbol">∀{</a><a id="350" href="V2.Interpreter.html#350" class="Bound">t</a><a id="351" class="Symbol">}</a> <a id="353" class="Symbol">(</a><a id="354" href="V2.Interpreter.html#354" class="Bound">e</a> <a id="356" class="Symbol">:</a> <a id="358" href="V2.WellTypedSyntax.html#505" class="Datatype">Exp</a> <a id="362" href="V2.Interpreter.html#317" class="Bound">Γ</a> <a id="364" href="V2.Interpreter.html#350" class="Bound">t</a><a id="365" class="Symbol">)</a> <a id="367" class="Symbol">→</a> <a id="369" href="V2.Value.html#150" class="Function">Val</a> <a id="373" href="V2.Interpreter.html#350" class="Bound">t</a>
  <a id="377" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="382" class="Symbol">(</a><a id="383" href="V2.WellTypedSyntax.html#555" class="InductiveConstructor">eInt</a>  <a id="389" href="V2.Interpreter.html#389" class="Bound">i</a><a id="390" class="Symbol">)</a>        <a id="399" class="Symbol">=</a> <a id="401" href="V2.Interpreter.html#389" class="Bound">i</a>
  <a id="405" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="410" class="Symbol">(</a><a id="411" href="V2.WellTypedSyntax.html#617" class="InductiveConstructor">eBool</a> <a id="417" href="V2.Interpreter.html#417" class="Bound">b</a><a id="418" class="Symbol">)</a>        <a id="427" class="Symbol">=</a> <a id="429" href="V2.Interpreter.html#417" class="Bound">b</a>
  <a id="433" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="438" class="Symbol">(</a><a id="439" href="V2.WellTypedSyntax.html#773" class="InductiveConstructor">eVar</a> <a id="444" href="V2.Interpreter.html#444" class="Bound">x</a><a id="445" class="Symbol">)</a>         <a id="455" class="Symbol">=</a> <a id="457" href="Data.List.Relation.Unary.All.html#5249" class="Function">All.lookup</a> <a id="468" href="V2.Interpreter.html#321" class="Bound">ρ</a> <a id="470" href="V2.Interpreter.html#444" class="Bound">x</a>
  <a id="474" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="479" class="Symbol">(</a><a id="480" href="V2.WellTypedSyntax.html#696" class="InductiveConstructor">eOp</a> <a id="484" href="V2.WellTypedSyntax.html#387" class="InductiveConstructor">plus</a> <a id="489" href="V2.Interpreter.html#489" class="Bound">e₁</a> <a id="492" href="V2.Interpreter.html#492" class="Bound">e₂</a><a id="494" class="Symbol">)</a> <a id="496" class="Symbol">=</a> <a id="498" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="503" href="V2.Interpreter.html#489" class="Bound">e₁</a> <a id="506" href="Data.Integer.Base.html#2950" class="Function Operator">+</a> <a id="508" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="513" href="V2.Interpreter.html#492" class="Bound">e₂</a>
  <a id="518" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="523" class="Symbol">(</a><a id="524" href="V2.WellTypedSyntax.html#696" class="InductiveConstructor">eOp</a> <a id="528" href="V2.WellTypedSyntax.html#409" class="InductiveConstructor">gt</a>  <a id="532" href="V2.Interpreter.html#532" class="Bound">e₁</a> <a id="535" href="V2.Interpreter.html#535" class="Bound">e₂</a><a id="537" class="Symbol">)</a>  <a id="540" class="Symbol">=</a> <a id="542" href="V2.Value.html#563" class="Function">iGt</a> <a id="546" class="Symbol">(</a><a id="547" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="552" href="V2.Interpreter.html#532" class="Bound">e₁</a><a id="554" class="Symbol">)</a> <a id="556" class="Symbol">(</a><a id="557" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="562" href="V2.Interpreter.html#535" class="Bound">e₂</a><a id="564" class="Symbol">)</a>
  <a id="568" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="573" class="Symbol">(</a><a id="574" href="V2.WellTypedSyntax.html#696" class="InductiveConstructor">eOp</a> <a id="578" href="V2.WellTypedSyntax.html#432" class="InductiveConstructor">and</a> <a id="582" href="V2.Interpreter.html#582" class="Bound">e₁</a> <a id="585" href="V2.Interpreter.html#585" class="Bound">e₂</a><a id="587" class="Symbol">)</a>  <a id="590" class="Symbol">=</a> <a id="592" href="Function.html#3662" class="Function Operator">case</a> <a id="597" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="602" href="V2.Interpreter.html#582" class="Bound">e₁</a> <a id="605" href="Function.html#3662" class="Function Operator">of</a> <a id="608" class="Symbol">λ</a> <a id="610" class="Keyword">where</a>
                            <a id="644" href="V2.AST.html#496" class="InductiveConstructor">true</a>  <a id="650" class="Symbol">→</a> <a id="652" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="657" href="V2.Interpreter.html#585" class="Bound">e₂</a>
                            <a id="688" href="V2.AST.html#501" class="InductiveConstructor">false</a> <a id="694" class="Symbol">→</a> <a id="696" href="V2.AST.html#501" class="InductiveConstructor">false</a>

<a id="703" class="Keyword">open</a> <a id="708" href="V2.Interpreter.html#308" class="Module">EvalExp</a>

<a id="717" class="Comment">-- Execution of declarations, extending the environment.</a>

<a id="execDecl"></a><a id="775" href="V2.Interpreter.html#775" class="Function">execDecl</a> <a id="784" class="Symbol">:</a> <a id="786" class="Symbol">∀{</a><a id="788" href="V2.Interpreter.html#788" class="Bound">Γ</a> <a id="790" href="V2.Interpreter.html#790" class="Bound">t</a><a id="791" class="Symbol">}</a> <a id="793" class="Symbol">(</a><a id="794" href="V2.Interpreter.html#794" class="Bound">d</a> <a id="796" class="Symbol">:</a> <a id="798" href="V2.WellTypedSyntax.html#890" class="Datatype">Decl</a> <a id="803" href="V2.Interpreter.html#788" class="Bound">Γ</a> <a id="805" href="V2.Interpreter.html#790" class="Bound">t</a><a id="806" class="Symbol">)</a> <a id="808" class="Symbol">(</a><a id="809" href="V2.Interpreter.html#809" class="Bound">ρ</a> <a id="811" class="Symbol">:</a> <a id="813" href="V2.Value.html#388" class="Function">Env</a> <a id="817" href="V2.Interpreter.html#788" class="Bound">Γ</a><a id="818" class="Symbol">)</a> <a id="820" class="Symbol">→</a> <a id="822" href="V2.Value.html#388" class="Function">Env</a> <a id="826" class="Symbol">(</a><a id="827" href="V2.Interpreter.html#790" class="Bound">t</a> <a id="829" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="831" href="V2.Interpreter.html#788" class="Bound">Γ</a><a id="832" class="Symbol">)</a>
<a id="834" href="V2.Interpreter.html#775" class="Function">execDecl</a> <a id="843" class="Symbol">(</a><a id="844" href="V2.WellTypedSyntax.html#930" class="InductiveConstructor">dInit</a> <a id="850" href="V2.Interpreter.html#850" class="Bound">e</a><a id="851" class="Symbol">)</a> <a id="853" href="V2.Interpreter.html#853" class="Bound">ρ</a> <a id="855" class="Symbol">=</a> <a id="857" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="862" href="V2.Interpreter.html#853" class="Bound">ρ</a> <a id="864" href="V2.Interpreter.html#850" class="Bound">e</a> <a id="866" href="Data.List.Relation.Unary.All.html#1256" class="InductiveConstructor Operator">∷</a> <a id="868" href="V2.Interpreter.html#853" class="Bound">ρ</a>

<a id="execDecls"></a><a id="871" href="V2.Interpreter.html#871" class="Function">execDecls</a> <a id="881" class="Symbol">:</a> <a id="883" class="Symbol">∀{</a><a id="885" href="V2.Interpreter.html#885" class="Bound">Γ</a> <a id="887" href="V2.Interpreter.html#887" class="Bound">Γ&#39;</a><a id="889" class="Symbol">}</a> <a id="891" class="Symbol">(</a><a id="892" href="V2.Interpreter.html#892" class="Bound">ds</a> <a id="895" class="Symbol">:</a> <a id="897" href="V2.WellTypedSyntax.html#969" class="Datatype">Decls</a> <a id="903" href="V2.Interpreter.html#885" class="Bound">Γ</a> <a id="905" href="V2.Interpreter.html#887" class="Bound">Γ&#39;</a><a id="907" class="Symbol">)</a> <a id="909" class="Symbol">(</a><a id="910" href="V2.Interpreter.html#910" class="Bound">ρ</a> <a id="912" class="Symbol">:</a> <a id="914" href="V2.Value.html#388" class="Function">Env</a> <a id="918" href="V2.Interpreter.html#885" class="Bound">Γ</a><a id="919" class="Symbol">)</a> <a id="921" class="Symbol">→</a> <a id="923" href="V2.Value.html#388" class="Function">Env</a> <a id="927" href="V2.Interpreter.html#887" class="Bound">Γ&#39;</a>
<a id="930" href="V2.Interpreter.html#871" class="Function">execDecls</a> <a id="940" href="V2.WellTypedSyntax.html#1005" class="InductiveConstructor">[]</a>       <a id="949" href="V2.Interpreter.html#949" class="Bound">ρ</a> <a id="951" class="Symbol">=</a> <a id="953" href="V2.Interpreter.html#949" class="Bound">ρ</a>
<a id="955" href="V2.Interpreter.html#871" class="Function">execDecls</a> <a id="965" class="Symbol">(</a><a id="966" href="V2.Interpreter.html#966" class="Bound">d</a> <a id="968" href="V2.WellTypedSyntax.html#1023" class="InductiveConstructor Operator">∷</a> <a id="970" href="V2.Interpreter.html#970" class="Bound">ds</a><a id="972" class="Symbol">)</a> <a id="974" href="V2.Interpreter.html#974" class="Bound">ρ</a> <a id="976" class="Symbol">=</a> <a id="978" href="V2.Interpreter.html#871" class="Function">execDecls</a> <a id="988" href="V2.Interpreter.html#970" class="Bound">ds</a> <a id="991" class="Symbol">(</a><a id="992" href="V2.Interpreter.html#775" class="Function">execDecl</a> <a id="1001" href="V2.Interpreter.html#966" class="Bound">d</a> <a id="1003" href="V2.Interpreter.html#974" class="Bound">ρ</a><a id="1004" class="Symbol">)</a>

<a id="1007" class="Comment">-- Execution of the program (main loop).</a>

<a id="runProgram"></a><a id="1049" href="V2.Interpreter.html#1049" class="Function">runProgram</a> <a id="1060" class="Symbol">:</a> <a id="1062" class="Symbol">(</a><a id="1063" href="V2.Interpreter.html#1063" class="Bound">prg</a> <a id="1067" class="Symbol">:</a> <a id="1069" href="V2.WellTypedSyntax.html#1159" class="Record">Program</a><a id="1076" class="Symbol">)</a> <a id="1078" class="Symbol">→</a> <a id="1080" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a>
<a id="1082" href="V2.Interpreter.html#1049" class="Function">runProgram</a> <a id="1093" class="Symbol">(</a><a id="1094" href="V2.WellTypedSyntax.html#1193" class="InductiveConstructor">program</a> <a id="1102" href="V2.Interpreter.html#1102" class="Bound">ds</a> <a id="1105" href="V2.Interpreter.html#1105" class="Bound">e</a><a id="1106" class="Symbol">)</a> <a id="1108" class="Symbol">=</a>

  <a id="1113" class="Comment">-- Execute the declarations to get the initial environment ρ.</a>
  <a id="1177" class="Keyword">let</a> <a id="1181" href="V2.Interpreter.html#1181" class="Bound">ρ</a> <a id="1183" class="Symbol">=</a> <a id="1185" href="V2.Interpreter.html#871" class="Function">execDecls</a> <a id="1195" href="V2.Interpreter.html#1102" class="Bound">ds</a> <a id="1198" href="Data.List.Relation.Unary.All.html#1239" class="InductiveConstructor">[]</a> <a id="1201" class="Keyword">in</a>

  <a id="1207" class="Comment">-- Evaluate the main expression to yield result.</a>
  <a id="1258" href="V2.Interpreter.html#341" class="Function">EvalExp.eval</a> <a id="1271" href="V2.Interpreter.html#1181" class="Bound">ρ</a> <a id="1273" href="V2.Interpreter.html#1105" class="Bound">e</a>
</pre></body></html>