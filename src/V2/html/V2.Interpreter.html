<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>V2.Interpreter</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Interpreter for WHILE language.</a>

<a id="37" class="Comment">-- As computation is not guaranteed to terminate,</a>
<a id="87" class="Comment">-- execution of statements is placed in the Delay monad.</a>

<a id="145" class="Keyword">module</a> <a id="152" href="V2.Interpreter.html" class="Module">V2.Interpreter</a> <a id="167" class="Keyword">where</a>

<a id="174" class="Keyword">open</a> <a id="179" class="Keyword">import</a> <a id="186" href="Library.html" class="Module">Library</a>
<a id="194" class="Keyword">open</a> <a id="199" class="Keyword">import</a> <a id="206" href="V2.WellTypedSyntax.html" class="Module">V2.WellTypedSyntax</a>
<a id="225" class="Keyword">open</a> <a id="230" class="Keyword">import</a> <a id="237" href="V2.Value.html" class="Module">V2.Value</a>

<a id="247" class="Comment">-- Evaluation of expressions in fixed environment ρ.</a>

<a id="301" class="Keyword">module</a> <a id="EvalExp"></a><a id="308" href="V2.Interpreter.html#308" class="Module">EvalExp</a> <a id="316" class="Symbol">{</a><a id="317" href="V2.Interpreter.html#317" class="Bound">Γ</a><a id="318" class="Symbol">}</a> <a id="320" class="Symbol">(</a><a id="321" href="V2.Interpreter.html#321" class="Bound">ρ</a> <a id="323" class="Symbol">:</a> <a id="325" href="V2.Value.html#388" class="Function">Env</a> <a id="329" href="V2.Interpreter.html#317" class="Bound">Γ</a><a id="330" class="Symbol">)</a> <a id="332" class="Keyword">where</a>

  <a id="EvalExp.eval"></a><a id="341" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="346" class="Symbol">:</a> <a id="348" class="Symbol">∀{</a><a id="350" href="V2.Interpreter.html#350" class="Bound">t</a><a id="351" class="Symbol">}</a> <a id="353" class="Symbol">(</a><a id="354" href="V2.Interpreter.html#354" class="Bound">e</a> <a id="356" class="Symbol">:</a> <a id="358" href="V2.WellTypedSyntax.html#582" class="Datatype">Exp</a> <a id="362" href="V2.Interpreter.html#317" class="Bound">Γ</a> <a id="364" href="V2.Interpreter.html#350" class="Bound">t</a><a id="365" class="Symbol">)</a> <a id="367" class="Symbol">→</a> <a id="369" href="V2.Value.html#150" class="Function">Val</a> <a id="373" href="V2.Interpreter.html#350" class="Bound">t</a>
  <a id="377" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="382" class="Symbol">(</a><a id="383" href="V2.WellTypedSyntax.html#632" class="InductiveConstructor">eInt</a>  <a id="389" href="V2.Interpreter.html#389" class="Bound">i</a><a id="390" class="Symbol">)</a>        <a id="399" class="Symbol">=</a> <a id="401" href="V2.Interpreter.html#389" class="Bound">i</a>
  <a id="405" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="410" class="Symbol">(</a><a id="411" href="V2.WellTypedSyntax.html#694" class="InductiveConstructor">eBool</a> <a id="417" href="V2.Interpreter.html#417" class="Bound">b</a><a id="418" class="Symbol">)</a>        <a id="427" class="Symbol">=</a> <a id="429" href="V2.Interpreter.html#417" class="Bound">b</a>
  <a id="433" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="438" class="Symbol">(</a><a id="439" href="V2.WellTypedSyntax.html#850" class="InductiveConstructor">eVar</a> <a id="444" href="V2.Interpreter.html#444" class="Bound">x</a><a id="445" class="Symbol">)</a>         <a id="455" class="Symbol">=</a> <a id="457" href="V2.Value.html#419" class="Function">lookupEnv</a> <a id="467" href="V2.Interpreter.html#321" class="Bound">ρ</a> <a id="469" href="V2.Interpreter.html#444" class="Bound">x</a>
  <a id="473" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="478" class="Symbol">(</a><a id="479" href="V2.WellTypedSyntax.html#773" class="InductiveConstructor">eOp</a> <a id="483" href="V2.WellTypedSyntax.html#464" class="InductiveConstructor">plus</a> <a id="488" href="V2.Interpreter.html#488" class="Bound">e₁</a> <a id="491" href="V2.Interpreter.html#491" class="Bound">e₂</a><a id="493" class="Symbol">)</a> <a id="495" class="Symbol">=</a> <a id="497" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="502" href="V2.Interpreter.html#488" class="Bound">e₁</a> <a id="505" href="Data.Integer.Base.html#2950" class="Function Operator">+</a> <a id="507" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="512" href="V2.Interpreter.html#491" class="Bound">e₂</a>
  <a id="517" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="522" class="Symbol">(</a><a id="523" href="V2.WellTypedSyntax.html#773" class="InductiveConstructor">eOp</a> <a id="527" href="V2.WellTypedSyntax.html#486" class="InductiveConstructor">gt</a>  <a id="531" href="V2.Interpreter.html#531" class="Bound">e₁</a> <a id="534" href="V2.Interpreter.html#534" class="Bound">e₂</a><a id="536" class="Symbol">)</a>  <a id="539" class="Symbol">=</a> <a id="541" href="V2.Value.html#686" class="Function">iGt</a> <a id="545" class="Symbol">(</a><a id="546" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="551" href="V2.Interpreter.html#531" class="Bound">e₁</a><a id="553" class="Symbol">)</a> <a id="555" class="Symbol">(</a><a id="556" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="561" href="V2.Interpreter.html#534" class="Bound">e₂</a><a id="563" class="Symbol">)</a>
  <a id="567" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="572" class="Symbol">(</a><a id="573" href="V2.WellTypedSyntax.html#773" class="InductiveConstructor">eOp</a> <a id="577" href="V2.WellTypedSyntax.html#509" class="InductiveConstructor">and</a> <a id="581" href="V2.Interpreter.html#581" class="Bound">e₁</a> <a id="584" href="V2.Interpreter.html#584" class="Bound">e₂</a><a id="586" class="Symbol">)</a>  <a id="589" class="Symbol">=</a> <a id="591" href="Function.html#3662" class="Function Operator">case</a> <a id="596" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="601" href="V2.Interpreter.html#581" class="Bound">e₁</a> <a id="604" href="Function.html#3662" class="Function Operator">of</a> <a id="607" class="Symbol">λ</a> <a id="609" class="Keyword">where</a>
                            <a id="643" href="V2.AST.html#496" class="InductiveConstructor">true</a>  <a id="649" class="Symbol">→</a> <a id="651" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="656" href="V2.Interpreter.html#584" class="Bound">e₂</a>
                            <a id="687" href="V2.AST.html#501" class="InductiveConstructor">false</a> <a id="693" class="Symbol">→</a> <a id="695" href="V2.AST.html#501" class="InductiveConstructor">false</a>

<a id="702" class="Keyword">open</a> <a id="707" href="V2.Interpreter.html#308" class="Module">EvalExp</a>

<a id="716" class="Comment">-- Execution of declarations, extending the environment.</a>

<a id="execDecl"></a><a id="774" href="V2.Interpreter.html#774" class="Function">execDecl</a> <a id="783" class="Symbol">:</a> <a id="785" class="Symbol">∀{</a><a id="787" href="V2.Interpreter.html#787" class="Bound">Γ</a> <a id="789" href="V2.Interpreter.html#789" class="Bound">t</a><a id="790" class="Symbol">}</a> <a id="792" class="Symbol">(</a><a id="793" href="V2.Interpreter.html#793" class="Bound">d</a> <a id="795" class="Symbol">:</a> <a id="797" href="V2.WellTypedSyntax.html#967" class="Datatype">Decl</a> <a id="802" href="V2.Interpreter.html#787" class="Bound">Γ</a> <a id="804" href="V2.Interpreter.html#789" class="Bound">t</a><a id="805" class="Symbol">)</a> <a id="807" class="Symbol">(</a><a id="808" href="V2.Interpreter.html#808" class="Bound">ρ</a> <a id="810" class="Symbol">:</a> <a id="812" href="V2.Value.html#388" class="Function">Env</a> <a id="816" href="V2.Interpreter.html#787" class="Bound">Γ</a><a id="817" class="Symbol">)</a> <a id="819" class="Symbol">→</a> <a id="821" href="V2.Value.html#388" class="Function">Env</a> <a id="825" class="Symbol">(</a><a id="826" href="V2.Interpreter.html#789" class="Bound">t</a> <a id="828" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="830" href="V2.Interpreter.html#787" class="Bound">Γ</a><a id="831" class="Symbol">)</a>
<a id="833" href="V2.Interpreter.html#774" class="Function">execDecl</a> <a id="842" class="Symbol">(</a><a id="843" href="V2.WellTypedSyntax.html#1007" class="InductiveConstructor">dInit</a> <a id="849" href="V2.Interpreter.html#849" class="Bound">e</a><a id="850" class="Symbol">)</a> <a id="852" href="V2.Interpreter.html#852" class="Bound">ρ</a> <a id="854" class="Symbol">=</a> <a id="856" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="861" href="V2.Interpreter.html#852" class="Bound">ρ</a> <a id="863" href="V2.Interpreter.html#849" class="Bound">e</a> <a id="865" href="Data.List.Relation.Unary.All.html#1256" class="InductiveConstructor Operator">∷</a> <a id="867" href="V2.Interpreter.html#852" class="Bound">ρ</a>

<a id="execDecls"></a><a id="870" href="V2.Interpreter.html#870" class="Function">execDecls</a> <a id="880" class="Symbol">:</a> <a id="882" class="Symbol">∀{</a><a id="884" href="V2.Interpreter.html#884" class="Bound">Γ</a> <a id="886" href="V2.Interpreter.html#886" class="Bound">Γ&#39;</a><a id="888" class="Symbol">}</a> <a id="890" class="Symbol">(</a><a id="891" href="V2.Interpreter.html#891" class="Bound">ds</a> <a id="894" class="Symbol">:</a> <a id="896" href="V2.WellTypedSyntax.html#1046" class="Datatype">Decls</a> <a id="902" href="V2.Interpreter.html#884" class="Bound">Γ</a> <a id="904" href="V2.Interpreter.html#886" class="Bound">Γ&#39;</a><a id="906" class="Symbol">)</a> <a id="908" class="Symbol">(</a><a id="909" href="V2.Interpreter.html#909" class="Bound">ρ</a> <a id="911" class="Symbol">:</a> <a id="913" href="V2.Value.html#388" class="Function">Env</a> <a id="917" href="V2.Interpreter.html#884" class="Bound">Γ</a><a id="918" class="Symbol">)</a> <a id="920" class="Symbol">→</a> <a id="922" href="V2.Value.html#388" class="Function">Env</a> <a id="926" href="V2.Interpreter.html#886" class="Bound">Γ&#39;</a>
<a id="929" href="V2.Interpreter.html#870" class="Function">execDecls</a> <a id="939" href="V2.WellTypedSyntax.html#1082" class="InductiveConstructor">[]</a>       <a id="948" href="V2.Interpreter.html#948" class="Bound">ρ</a> <a id="950" class="Symbol">=</a> <a id="952" href="V2.Interpreter.html#948" class="Bound">ρ</a>
<a id="954" href="V2.Interpreter.html#870" class="Function">execDecls</a> <a id="964" class="Symbol">(</a><a id="965" href="V2.Interpreter.html#965" class="Bound">d</a> <a id="967" href="V2.WellTypedSyntax.html#1100" class="InductiveConstructor Operator">∷</a> <a id="969" href="V2.Interpreter.html#969" class="Bound">ds</a><a id="971" class="Symbol">)</a> <a id="973" href="V2.Interpreter.html#973" class="Bound">ρ</a> <a id="975" class="Symbol">=</a> <a id="977" href="V2.Interpreter.html#870" class="Function">execDecls</a> <a id="987" href="V2.Interpreter.html#969" class="Bound">ds</a> <a id="990" class="Symbol">(</a><a id="991" href="V2.Interpreter.html#774" class="Function">execDecl</a> <a id="1000" href="V2.Interpreter.html#965" class="Bound">d</a> <a id="1002" href="V2.Interpreter.html#973" class="Bound">ρ</a><a id="1003" class="Symbol">)</a>

<a id="1006" class="Comment">-- Execution of the program (main loop).</a>

<a id="runProgram"></a><a id="1048" href="V2.Interpreter.html#1048" class="Function">runProgram</a> <a id="1059" class="Symbol">:</a> <a id="1061" class="Symbol">(</a><a id="1062" href="V2.Interpreter.html#1062" class="Bound">prg</a> <a id="1066" class="Symbol">:</a> <a id="1068" href="V2.WellTypedSyntax.html#1236" class="Record">Program</a><a id="1075" class="Symbol">)</a> <a id="1077" class="Symbol">→</a> <a id="1079" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a>
<a id="1081" href="V2.Interpreter.html#1048" class="Function">runProgram</a> <a id="1092" class="Symbol">(</a><a id="1093" href="V2.WellTypedSyntax.html#1270" class="InductiveConstructor">program</a> <a id="1101" href="V2.Interpreter.html#1101" class="Bound">ds</a> <a id="1104" href="V2.Interpreter.html#1104" class="Bound">e</a><a id="1105" class="Symbol">)</a> <a id="1107" class="Symbol">=</a>

  <a id="1112" class="Comment">-- Execute the declarations to get the initial environment ρ.</a>
  <a id="1176" class="Keyword">let</a> <a id="1180" href="V2.Interpreter.html#1180" class="Bound">ρ</a> <a id="1182" class="Symbol">=</a> <a id="1184" href="V2.Interpreter.html#870" class="Function">execDecls</a> <a id="1194" href="V2.Interpreter.html#1101" class="Bound">ds</a> <a id="1197" href="Data.List.Relation.Unary.All.html#1239" class="InductiveConstructor">[]</a> <a id="1200" class="Keyword">in</a>

  <a id="1206" class="Comment">-- Evaluate the main expression to yield result.</a>
  <a id="1257" href="V2.Interpreter.html#341" class="Function">EvalExp.eval</a> <a id="1270" href="V2.Interpreter.html#1180" class="Bound">ρ</a> <a id="1272" href="V2.Interpreter.html#1104" class="Bound">e</a>
</pre></body></html>