<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>V2.TypeChecker</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Type checker for the WHILE language.</a>

<a id="42" class="Symbol">{-#</a> <a id="46" class="Keyword">OPTIONS</a> <a id="54" class="Pragma">--postfix-projections</a> <a id="76" class="Symbol">#-}</a>

<a id="81" class="Keyword">module</a> <a id="88" href="V2.TypeChecker.html" class="Module">V2.TypeChecker</a> <a id="103" class="Keyword">where</a>

<a id="110" class="Keyword">open</a> <a id="115" class="Keyword">import</a> <a id="122" href="Library.html" class="Module">Library</a>

<a id="131" class="Keyword">import</a> <a id="138" href="V2.AST.html" class="Module">V2.AST</a> <a id="145" class="Symbol">as</a> <a id="148" class="Module">A</a>
<a id="150" class="Keyword">open</a> <a id="155" class="Keyword">import</a> <a id="162" href="V2.WellTypedSyntax.html" class="Module">V2.WellTypedSyntax</a>

<a id="182" class="Comment">-- Names as coming from the abstract syntax are just strings.</a>

<a id="Name"></a><a id="245" href="V2.TypeChecker.html#245" class="Function">Name</a> <a id="250" class="Symbol">=</a> <a id="252" href="Agda.Builtin.String.html#247" class="Postulate">String</a>

<a id="idToName"></a><a id="260" href="V2.TypeChecker.html#260" class="Function">idToName</a> <a id="269" class="Symbol">:</a> <a id="271" href="V2.AST.html#282" class="Datatype">A.Id</a> <a id="276" class="Symbol">→</a> <a id="278" href="V2.TypeChecker.html#245" class="Function">Name</a>
<a id="283" href="V2.TypeChecker.html#260" class="Function">idToName</a> <a id="292" class="Symbol">(</a><a id="293" href="V2.AST.html#299" class="InductiveConstructor">A.mkId</a> <a id="300" href="V2.TypeChecker.html#300" class="Bound">x</a><a id="301" class="Symbol">)</a> <a id="303" class="Symbol">=</a> <a id="305" href="Agda.Builtin.String.html#345" class="Primitive">String.fromList</a> <a id="321" href="V2.TypeChecker.html#300" class="Bound">x</a>

<a id="324" class="Comment">-- Local context for the type checker.</a>

<a id="TCCxt"></a><a id="364" href="V2.TypeChecker.html#364" class="Function">TCCxt</a> <a id="370" class="Symbol">:</a> <a id="372" class="Symbol">(</a><a id="373" href="V2.TypeChecker.html#373" class="Bound">Γ</a> <a id="375" class="Symbol">:</a> <a id="377" href="V2.WellTypedSyntax.html#255" class="Function">Cxt</a><a id="380" class="Symbol">)</a> <a id="382" class="Symbol">→</a> <a id="384" class="PrimitiveType">Set</a>
<a id="388" href="V2.TypeChecker.html#364" class="Function">TCCxt</a> <a id="394" href="V2.TypeChecker.html#394" class="Bound">Γ</a> <a id="396" class="Symbol">=</a> <a id="398" href="Library.List.html#1325" class="Function">AssocList</a> <a id="408" href="V2.TypeChecker.html#245" class="Function">Name</a> <a id="413" href="V2.TypeChecker.html#394" class="Bound">Γ</a>

<a id="416" class="Comment">-- Querying the local context.</a>

<a id="448" class="Comment">-- Type errors.</a>
<a id="464" class="Comment">--</a>
<a id="467" class="Comment">-- Currently, these errors do not carry enough evidence that</a>
<a id="528" class="Comment">-- something is wrong.  The type checker does not produce</a>
<a id="586" class="Comment">-- evidence of ill-typedness in case of failure,</a>
<a id="635" class="Comment">-- only of well-typedness in case of success.</a>

<a id="682" class="Keyword">data</a> <a id="TypeError"></a><a id="687" href="V2.TypeChecker.html#687" class="Datatype">TypeError</a> <a id="697" class="Symbol">:</a> <a id="699" class="PrimitiveType">Set</a> <a id="703" class="Keyword">where</a>
  <a id="TypeError.unboundVariable"></a><a id="711" href="V2.TypeChecker.html#711" class="InductiveConstructor">unboundVariable</a>        <a id="734" class="Symbol">:</a> <a id="736" href="V2.TypeChecker.html#245" class="Function">Name</a> <a id="741" class="Symbol">→</a> <a id="743" href="V2.TypeChecker.html#687" class="Datatype">TypeError</a>
  <a id="TypeError.typeMismatch"></a><a id="755" href="V2.TypeChecker.html#755" class="InductiveConstructor">typeMismatch</a>           <a id="778" class="Symbol">:</a> <a id="780" class="Symbol">(</a><a id="781" href="V2.TypeChecker.html#781" class="Bound">tinf</a> <a id="786" href="V2.TypeChecker.html#786" class="Bound">texp</a> <a id="791" class="Symbol">:</a> <a id="793" href="V2.AST.html#372" class="Datatype">Type</a><a id="797" class="Symbol">)</a>  <a id="800" class="Symbol">→</a> <a id="802" href="V2.TypeChecker.html#781" class="Bound">tinf</a> <a id="807" href="Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">≢</a> <a id="809" href="V2.TypeChecker.html#786" class="Bound">texp</a> <a id="814" class="Symbol">→</a> <a id="816" href="V2.TypeChecker.html#687" class="Datatype">TypeError</a>

<a id="827" class="Keyword">instance</a>
  <a id="PrintError"></a><a id="838" href="V2.TypeChecker.html#838" class="Function">PrintError</a> <a id="849" class="Symbol">:</a> <a id="851" href="Library.Print.html#196" class="Record">Print</a> <a id="857" href="V2.TypeChecker.html#687" class="Datatype">TypeError</a>
  <a id="869" href="Library.Print.html#244" class="Field">print</a> <a id="875" class="Symbol">{{</a><a id="877" href="V2.TypeChecker.html#838" class="Function">PrintError</a><a id="887" class="Symbol">}}</a> <a id="890" class="Symbol">=</a> <a id="892" class="Symbol">λ</a> <a id="894" class="Keyword">where</a>
    <a id="904" class="Symbol">(</a><a id="905" href="V2.TypeChecker.html#711" class="InductiveConstructor">unboundVariable</a> <a id="921" href="V2.TypeChecker.html#921" class="Bound">x</a><a id="922" class="Symbol">)</a>        <a id="931" class="Symbol">→</a> <a id="933" class="String">&quot;unbound variable &quot;</a> <a id="953" href="Data.String.Base.html#1744" class="Function Operator">String.++</a> <a id="963" href="V2.TypeChecker.html#921" class="Bound">x</a>
    <a id="969" class="Symbol">(</a><a id="970" href="V2.TypeChecker.html#755" class="InductiveConstructor">typeMismatch</a> <a id="983" href="V2.TypeChecker.html#983" class="Bound">tinf</a> <a id="988" href="V2.TypeChecker.html#988" class="Bound">texp</a> <a id="993" class="Symbol">_)</a> <a id="996" class="Symbol">→</a> <a id="998" href="Data.String.Base.html#1932" class="Function">String.concat</a> <a id="1012" href="Function.html#1645" class="Function Operator">$</a>
      <a id="1020" class="String">&quot;type mismatch: expected &quot;</a> <a id="1047" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="1049" href="Library.Print.html#244" class="Field">print</a> <a id="1055" href="V2.TypeChecker.html#988" class="Bound">texp</a> <a id="1060" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a>
      <a id="1068" class="String">&quot;, but inferred &quot;</a> <a id="1086" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="1088" href="Library.Print.html#244" class="Field">print</a> <a id="1094" href="V2.TypeChecker.html#983" class="Bound">tinf</a> <a id="1099" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="1101" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a>

<a id="1105" class="Comment">-- Type error monad.</a>

<a id="1127" class="Keyword">open</a> <a id="1132" href="Library.Error.html#134" class="Module">ErrorMonad</a> <a id="1143" class="Symbol">{</a><a id="1144" class="Argument">E</a> <a id="1146" class="Symbol">=</a> <a id="1148" href="V2.TypeChecker.html#687" class="Datatype">TypeError</a><a id="1157" class="Symbol">}</a>

<a id="1160" class="Comment">-- Checking expressions</a>
<a id="1184" class="Comment">---------------------------------------------------------------------------</a>

<a id="1261" class="Keyword">module</a> <a id="CheckExpressions"></a><a id="1268" href="V2.TypeChecker.html#1268" class="Module">CheckExpressions</a> <a id="1285" class="Symbol">{</a><a id="1286" href="V2.TypeChecker.html#1286" class="Bound">Γ</a> <a id="1288" class="Symbol">:</a> <a id="1290" href="V2.WellTypedSyntax.html#255" class="Function">Cxt</a><a id="1293" class="Symbol">}</a> <a id="1295" class="Symbol">(</a><a id="1296" href="V2.TypeChecker.html#1296" class="Bound">γ</a> <a id="1298" class="Symbol">:</a> <a id="1300" href="V2.TypeChecker.html#364" class="Function">TCCxt</a> <a id="1306" href="V2.TypeChecker.html#1286" class="Bound">Γ</a><a id="1307" class="Symbol">)</a> <a id="1309" class="Keyword">where</a>

  <a id="1318" class="Comment">-- Environment.</a>

  <a id="CheckExpressions.lookupVar"></a><a id="1337" href="V2.TypeChecker.html#1337" class="Function">lookupVar</a> <a id="1347" class="Symbol">:</a> <a id="1349" class="Symbol">(</a><a id="1350" href="V2.TypeChecker.html#1350" class="Bound">x</a> <a id="1352" class="Symbol">:</a> <a id="1354" href="V2.TypeChecker.html#245" class="Function">Name</a><a id="1358" class="Symbol">)</a> <a id="1360" class="Symbol">→</a> <a id="1362" href="Library.Error.html#170" class="Function">Error</a> <a id="1368" class="Symbol">(</a><a id="1369" href="Data.Product.html#1364" class="Function">∃</a> <a id="1371" class="Symbol">λ</a> <a id="1373" href="V2.TypeChecker.html#1373" class="Bound">t</a> <a id="1375" class="Symbol">→</a> <a id="1377" href="V2.WellTypedSyntax.html#272" class="Function">Var</a> <a id="1381" href="V2.TypeChecker.html#1286" class="Bound">Γ</a> <a id="1383" href="V2.TypeChecker.html#1373" class="Bound">t</a><a id="1384" class="Symbol">)</a>
  <a id="1388" href="V2.TypeChecker.html#1337" class="Function">lookupVar</a> <a id="1398" href="V2.TypeChecker.html#1398" class="Bound">x</a> <a id="1400" class="Symbol">=</a>
    <a id="1406" href="Function.html#3662" class="Function Operator">case</a> <a id="1411" href="Library.List.html#1758" class="Function Operator">?↦</a> <a id="1414" href="V2.TypeChecker.html#1398" class="Bound">x</a> <a id="1416" href="Library.List.html#1758" class="Function Operator">∈</a> <a id="1418" href="V2.TypeChecker.html#1296" class="Bound">γ</a> <a id="1420" href="Function.html#3662" class="Function Operator">of</a> <a id="1423" class="Symbol">λ</a> <a id="1425" class="Keyword">where</a>
      <a id="1437" class="Symbol">(</a><a id="1438" href="Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="1442" class="Symbol">(</a><a id="1443" href="V2.TypeChecker.html#1443" class="Bound">t</a> <a id="1445" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1447" href="V2.TypeChecker.html#1447" class="Bound">x&#39;</a> <a id="1450" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1452" class="Symbol">_))</a> <a id="1456" class="Symbol">→</a> <a id="1458" href="Library.Monad.html#1110" class="Function">return</a> <a id="1465" class="Symbol">(</a><a id="1466" href="V2.TypeChecker.html#1443" class="Bound">t</a> <a id="1468" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1470" href="V2.TypeChecker.html#1447" class="Bound">x&#39;</a><a id="1472" class="Symbol">)</a>
      <a id="1480" class="Symbol">(</a><a id="1481" href="Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="1484" href="V2.TypeChecker.html#1484" class="Bound">¬p</a><a id="1486" class="Symbol">)</a>            <a id="1499" class="Symbol">→</a> <a id="1501" href="Library.Error.html#912" class="Function">throwError</a> <a id="1512" href="Function.html#1645" class="Function Operator">$</a> <a id="1514" href="V2.TypeChecker.html#711" class="InductiveConstructor">unboundVariable</a> <a id="1530" href="V2.TypeChecker.html#1398" class="Bound">x</a>

  <a id="1535" class="Comment">-- The expression checker.</a>

  <a id="1565" class="Keyword">mutual</a>

    <a id="1577" class="Comment">-- Type inference.</a>

    <a id="CheckExpressions.inferExp"></a><a id="1601" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="1610" class="Symbol">:</a> <a id="1612" class="Symbol">(</a><a id="1613" href="V2.TypeChecker.html#1613" class="Bound">e</a> <a id="1615" class="Symbol">:</a> <a id="1617" href="V2.AST.html#584" class="Datatype">A.Exp</a><a id="1622" class="Symbol">)</a> <a id="1624" class="Symbol">→</a> <a id="1626" href="Library.Error.html#170" class="Function">Error</a> <a id="1632" class="Symbol">(</a><a id="1633" href="Data.Product.html#1364" class="Function">∃</a> <a id="1635" class="Symbol">λ</a> <a id="1637" class="Symbol">(</a><a id="1638" href="V2.TypeChecker.html#1638" class="Bound">t</a> <a id="1640" class="Symbol">:</a> <a id="1642" href="V2.AST.html#372" class="Datatype">Type</a><a id="1646" class="Symbol">)</a> <a id="1648" class="Symbol">→</a> <a id="1650" href="V2.WellTypedSyntax.html#505" class="Datatype">Exp</a> <a id="1654" href="V2.TypeChecker.html#1286" class="Bound">Γ</a> <a id="1656" href="V2.TypeChecker.html#1638" class="Bound">t</a><a id="1657" class="Symbol">)</a>

    <a id="1664" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="1673" class="Symbol">(</a><a id="1674" href="V2.AST.html#647" class="InductiveConstructor">A.eInt</a> <a id="1681" href="V2.TypeChecker.html#1681" class="Bound">i</a><a id="1682" class="Symbol">)</a>  <a id="1685" class="Symbol">=</a> <a id="1687" href="Library.Monad.html#1110" class="Function">return</a> <a id="1694" class="Symbol">(</a><a id="1695" href="V2.AST.html#396" class="InductiveConstructor">int</a>  <a id="1700" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1702" href="V2.WellTypedSyntax.html#555" class="InductiveConstructor">eInt</a>  <a id="1708" href="V2.TypeChecker.html#1681" class="Bound">i</a><a id="1709" class="Symbol">)</a>
    <a id="1715" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="1724" class="Symbol">(</a><a id="1725" href="V2.AST.html#692" class="InductiveConstructor">A.eBool</a> <a id="1733" href="V2.TypeChecker.html#1733" class="Bound">b</a><a id="1734" class="Symbol">)</a> <a id="1736" class="Symbol">=</a> <a id="1738" href="Library.Monad.html#1110" class="Function">return</a> <a id="1745" class="Symbol">(</a><a id="1746" href="V2.AST.html#391" class="InductiveConstructor">bool</a> <a id="1751" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1753" href="V2.WellTypedSyntax.html#617" class="InductiveConstructor">eBool</a> <a id="1759" href="V2.TypeChecker.html#1733" class="Bound">b</a><a id="1760" class="Symbol">)</a>

    <a id="1767" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="1776" class="Symbol">(</a><a id="1777" href="V2.AST.html#602" class="InductiveConstructor">A.eId</a> <a id="1783" href="V2.TypeChecker.html#1783" class="Bound">x</a><a id="1784" class="Symbol">)</a> <a id="1786" class="Symbol">=</a> <a id="1788" class="Keyword">do</a>
      <a id="1797" class="Symbol">(</a><a id="1798" href="V2.TypeChecker.html#1798" class="Bound">t</a> <a id="1800" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1802" href="V2.TypeChecker.html#1802" class="Bound">x&#39;</a><a id="1804" class="Symbol">)</a> <a id="1806" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1808" href="V2.TypeChecker.html#1337" class="Function">lookupVar</a> <a id="1818" class="Symbol">(</a><a id="1819" href="V2.TypeChecker.html#260" class="Function">idToName</a> <a id="1828" href="V2.TypeChecker.html#1783" class="Bound">x</a><a id="1829" class="Symbol">)</a>
      <a id="1837" href="Library.Monad.html#1110" class="Function">return</a> <a id="1844" class="Symbol">(</a><a id="1845" href="V2.TypeChecker.html#1798" class="Bound">t</a> <a id="1847" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1849" href="V2.WellTypedSyntax.html#773" class="InductiveConstructor">eVar</a> <a id="1854" href="V2.TypeChecker.html#1802" class="Bound">x&#39;</a><a id="1856" class="Symbol">)</a>

    <a id="1863" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="1872" class="Symbol">(</a><a id="1873" href="V2.AST.html#737" class="InductiveConstructor">A.ePlus</a>  <a id="1882" href="V2.TypeChecker.html#1882" class="Bound">e₁</a> <a id="1885" href="V2.TypeChecker.html#1885" class="Bound">e₂</a><a id="1887" class="Symbol">)</a> <a id="1889" class="Symbol">=</a> <a id="1891" href="V2.TypeChecker.html#2357" class="Function">inferOp</a> <a id="1899" href="V2.WellTypedSyntax.html#387" class="InductiveConstructor">plus</a>  <a id="1905" href="V2.TypeChecker.html#1882" class="Bound">e₁</a> <a id="1908" href="V2.TypeChecker.html#1885" class="Bound">e₂</a>

    <a id="1916" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="1925" class="Symbol">(</a><a id="1926" href="V2.AST.html#782" class="InductiveConstructor">A.eGt</a>    <a id="1935" href="V2.TypeChecker.html#1935" class="Bound">e₁</a> <a id="1938" href="V2.TypeChecker.html#1938" class="Bound">e₂</a><a id="1940" class="Symbol">)</a> <a id="1942" class="Symbol">=</a> <a id="1944" href="V2.TypeChecker.html#2357" class="Function">inferOp</a> <a id="1952" href="V2.WellTypedSyntax.html#409" class="InductiveConstructor">gt</a>    <a id="1958" href="V2.TypeChecker.html#1935" class="Bound">e₁</a> <a id="1961" href="V2.TypeChecker.html#1938" class="Bound">e₂</a>

    <a id="1969" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="1978" class="Symbol">(</a><a id="1979" href="V2.AST.html#827" class="InductiveConstructor">A.eAnd</a>   <a id="1988" href="V2.TypeChecker.html#1988" class="Bound">e₁</a> <a id="1991" href="V2.TypeChecker.html#1991" class="Bound">e₂</a><a id="1993" class="Symbol">)</a> <a id="1995" class="Symbol">=</a> <a id="1997" href="V2.TypeChecker.html#2357" class="Function">inferOp</a> <a id="2005" href="V2.WellTypedSyntax.html#432" class="InductiveConstructor">and</a>   <a id="2011" href="V2.TypeChecker.html#1988" class="Bound">e₁</a> <a id="2014" href="V2.TypeChecker.html#1991" class="Bound">e₂</a>

    <a id="2022" class="Comment">-- Type checking.</a>
    <a id="2044" class="Comment">-- Calls inference and checks inferred type against given type.</a>

    <a id="CheckExpressions.checkExp"></a><a id="2113" href="V2.TypeChecker.html#2113" class="Function">checkExp</a> <a id="2122" class="Symbol">:</a> <a id="2124" class="Symbol">(</a><a id="2125" href="V2.TypeChecker.html#2125" class="Bound">e</a> <a id="2127" class="Symbol">:</a> <a id="2129" href="V2.AST.html#584" class="Datatype">A.Exp</a><a id="2134" class="Symbol">)</a> <a id="2136" class="Symbol">(</a><a id="2137" href="V2.TypeChecker.html#2137" class="Bound">t</a> <a id="2139" class="Symbol">:</a> <a id="2141" href="V2.AST.html#372" class="Datatype">Type</a><a id="2145" class="Symbol">)</a> <a id="2147" class="Symbol">→</a> <a id="2149" href="Library.Error.html#170" class="Function">Error</a> <a id="2155" class="Symbol">(</a><a id="2156" href="V2.WellTypedSyntax.html#505" class="Datatype">Exp</a> <a id="2160" href="V2.TypeChecker.html#1286" class="Bound">Γ</a> <a id="2162" href="V2.TypeChecker.html#2137" class="Bound">t</a><a id="2163" class="Symbol">)</a>
    <a id="2169" href="V2.TypeChecker.html#2113" class="Function">checkExp</a> <a id="2178" href="V2.TypeChecker.html#2178" class="Bound">e</a> <a id="2180" href="V2.TypeChecker.html#2180" class="Bound">t</a> <a id="2182" class="Symbol">=</a> <a id="2184" class="Keyword">do</a>
      <a id="2193" class="Symbol">(</a><a id="2194" href="V2.TypeChecker.html#2194" class="Bound">t&#39;</a> <a id="2197" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2199" href="V2.TypeChecker.html#2199" class="Bound">e&#39;</a><a id="2201" class="Symbol">)</a> <a id="2203" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2205" href="V2.TypeChecker.html#1601" class="Function">inferExp</a> <a id="2214" href="V2.TypeChecker.html#2178" class="Bound">e</a>
      <a id="2222" href="Function.html#3662" class="Function Operator">case</a> <a id="2227" href="V2.TypeChecker.html#2194" class="Bound">t&#39;</a> <a id="2230" href="Library.Eq.html#627" class="Field Operator">≟</a> <a id="2232" href="V2.TypeChecker.html#2180" class="Bound">t</a> <a id="2234" href="Function.html#3662" class="Function Operator">of</a> <a id="2237" class="Symbol">λ</a> <a id="2239" class="Keyword">where</a>
        <a id="2253" class="Symbol">(</a><a id="2254" href="Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="2258" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="2262" class="Symbol">)</a> <a id="2264" class="Symbol">→</a> <a id="2266" href="Library.Monad.html#1110" class="Function">return</a> <a id="2273" href="V2.TypeChecker.html#2199" class="Bound">e&#39;</a>
        <a id="2284" class="Symbol">(</a><a id="2285" href="Relation.Nullary.html#668" class="InductiveConstructor">no</a>  <a id="2289" href="V2.TypeChecker.html#2289" class="Bound">t&#39;≢t</a><a id="2293" class="Symbol">)</a> <a id="2295" class="Symbol">→</a> <a id="2297" href="Library.Error.html#912" class="Function">throwError</a> <a id="2308" class="Symbol">(</a><a id="2309" href="V2.TypeChecker.html#755" class="InductiveConstructor">typeMismatch</a> <a id="2322" href="V2.TypeChecker.html#2194" class="Bound">t&#39;</a> <a id="2325" href="V2.TypeChecker.html#2180" class="Bound">t</a> <a id="2327" href="V2.TypeChecker.html#2289" class="Bound">t&#39;≢t</a><a id="2331" class="Symbol">)</a>

    <a id="2338" class="Comment">-- Operators.</a>

    <a id="CheckExpressions.inferOp"></a><a id="2357" href="V2.TypeChecker.html#2357" class="Function">inferOp</a> <a id="2365" class="Symbol">:</a> <a id="2367" class="Symbol">∀{</a><a id="2369" href="V2.TypeChecker.html#2369" class="Bound">t</a> <a id="2371" href="V2.TypeChecker.html#2371" class="Bound">t&#39;</a><a id="2373" class="Symbol">}</a> <a id="2375" class="Symbol">(</a><a id="2376" href="V2.TypeChecker.html#2376" class="Bound">op</a> <a id="2379" class="Symbol">:</a> <a id="2381" href="V2.WellTypedSyntax.html#349" class="Datatype">Op</a> <a id="2384" href="V2.TypeChecker.html#2369" class="Bound">t</a> <a id="2386" href="V2.TypeChecker.html#2371" class="Bound">t&#39;</a><a id="2388" class="Symbol">)</a> <a id="2390" class="Symbol">(</a><a id="2391" href="V2.TypeChecker.html#2391" class="Bound">e₁</a> <a id="2394" href="V2.TypeChecker.html#2394" class="Bound">e₂</a> <a id="2397" class="Symbol">:</a> <a id="2399" href="V2.AST.html#584" class="Datatype">A.Exp</a><a id="2404" class="Symbol">)</a> <a id="2406" class="Symbol">→</a> <a id="2408" href="Library.Error.html#170" class="Function">Error</a> <a id="2414" class="Symbol">(</a><a id="2415" href="Data.Product.html#1364" class="Function">∃</a> <a id="2417" class="Symbol">λ</a> <a id="2419" href="V2.TypeChecker.html#2419" class="Bound">t</a> <a id="2421" class="Symbol">→</a> <a id="2423" href="V2.WellTypedSyntax.html#505" class="Datatype">Exp</a> <a id="2427" href="V2.TypeChecker.html#1286" class="Bound">Γ</a> <a id="2429" href="V2.TypeChecker.html#2419" class="Bound">t</a><a id="2430" class="Symbol">)</a>
    <a id="2436" href="V2.TypeChecker.html#2357" class="Function">inferOp</a> <a id="2444" class="Symbol">{</a><a id="2445" href="V2.TypeChecker.html#2445" class="Bound">t</a><a id="2446" class="Symbol">}</a> <a id="2448" class="Symbol">{</a><a id="2449" href="V2.TypeChecker.html#2449" class="Bound">t&#39;</a><a id="2451" class="Symbol">}</a> <a id="2453" href="V2.TypeChecker.html#2453" class="Bound">op</a> <a id="2456" href="V2.TypeChecker.html#2456" class="Bound">e₁</a> <a id="2459" href="V2.TypeChecker.html#2459" class="Bound">e₂</a> <a id="2462" class="Symbol">=</a> <a id="2464" class="Keyword">do</a>
      <a id="2473" href="V2.TypeChecker.html#2473" class="Bound">e₁&#39;</a> <a id="2477" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2479" href="V2.TypeChecker.html#2113" class="Function">checkExp</a> <a id="2488" href="V2.TypeChecker.html#2456" class="Bound">e₁</a> <a id="2491" href="V2.TypeChecker.html#2445" class="Bound">t</a>
      <a id="2499" href="V2.TypeChecker.html#2499" class="Bound">e₂&#39;</a> <a id="2503" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2505" href="V2.TypeChecker.html#2113" class="Function">checkExp</a> <a id="2514" href="V2.TypeChecker.html#2459" class="Bound">e₂</a> <a id="2517" href="V2.TypeChecker.html#2445" class="Bound">t</a>
      <a id="2525" href="Library.Monad.html#1110" class="Function">return</a> <a id="2532" class="Symbol">(</a><a id="2533" href="V2.TypeChecker.html#2449" class="Bound">t&#39;</a> <a id="2536" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2538" href="V2.WellTypedSyntax.html#696" class="InductiveConstructor">eOp</a> <a id="2542" href="V2.TypeChecker.html#2453" class="Bound">op</a> <a id="2545" href="V2.TypeChecker.html#2473" class="Bound">e₁&#39;</a> <a id="2549" href="V2.TypeChecker.html#2499" class="Bound">e₂&#39;</a><a id="2552" class="Symbol">)</a>

<a id="2555" class="Comment">-- The declaration checker calls the expression checker.</a>
<a id="2612" class="Comment">-- Exported interface of expression checker:</a>

<a id="2658" class="Comment">-- Monad for checking expressions</a>

<a id="2693" class="Keyword">record</a> <a id="TCExp"></a><a id="2700" href="V2.TypeChecker.html#2700" class="Record">TCExp</a> <a id="2706" href="V2.TypeChecker.html#2706" class="Bound">Γ</a> <a id="2708" class="Symbol">(</a><a id="2709" href="V2.TypeChecker.html#2709" class="Bound">A</a> <a id="2711" class="Symbol">:</a> <a id="2713" class="PrimitiveType">Set</a><a id="2716" class="Symbol">)</a> <a id="2718" class="Symbol">:</a> <a id="2720" class="PrimitiveType">Set</a> <a id="2724" class="Keyword">where</a>
  <a id="2732" class="Keyword">field</a>
    <a id="TCExp.runTCExp"></a><a id="2742" href="V2.TypeChecker.html#2742" class="Field">runTCExp</a> <a id="2751" class="Symbol">:</a> <a id="2753" href="V2.TypeChecker.html#364" class="Function">TCCxt</a> <a id="2759" href="V2.TypeChecker.html#2706" class="Bound">Γ</a> <a id="2761" class="Symbol">→</a> <a id="2763" href="Library.Error.html#170" class="Function">Error</a> <a id="2769" href="V2.TypeChecker.html#2709" class="Bound">A</a>
<a id="2771" class="Keyword">open</a> <a id="2776" href="V2.TypeChecker.html#2700" class="Module">TCExp</a>

<a id="checkExp"></a><a id="2783" href="V2.TypeChecker.html#2783" class="Function">checkExp</a> <a id="2792" class="Symbol">:</a> <a id="2794" class="Symbol">∀{</a><a id="2796" href="V2.TypeChecker.html#2796" class="Bound">Γ</a><a id="2797" class="Symbol">}</a> <a id="2799" class="Symbol">(</a><a id="2800" href="V2.TypeChecker.html#2800" class="Bound">e</a> <a id="2802" class="Symbol">:</a> <a id="2804" href="V2.AST.html#584" class="Datatype">A.Exp</a><a id="2809" class="Symbol">)</a> <a id="2811" class="Symbol">(</a><a id="2812" href="V2.TypeChecker.html#2812" class="Bound">t</a> <a id="2814" class="Symbol">:</a> <a id="2816" href="V2.AST.html#372" class="Datatype">Type</a><a id="2820" class="Symbol">)</a> <a id="2822" class="Symbol">→</a> <a id="2824" href="V2.TypeChecker.html#2700" class="Record">TCExp</a> <a id="2830" href="V2.TypeChecker.html#2796" class="Bound">Γ</a> <a id="2832" class="Symbol">(</a><a id="2833" href="V2.WellTypedSyntax.html#505" class="Datatype">Exp</a> <a id="2837" href="V2.TypeChecker.html#2796" class="Bound">Γ</a> <a id="2839" href="V2.TypeChecker.html#2812" class="Bound">t</a><a id="2840" class="Symbol">)</a>
<a id="2842" href="V2.TypeChecker.html#2783" class="Function">checkExp</a> <a id="2851" href="V2.TypeChecker.html#2851" class="Bound">e</a> <a id="2853" href="V2.TypeChecker.html#2853" class="Bound">t</a> <a id="2855" class="Symbol">.</a><a id="2856" href="V2.TypeChecker.html#2742" class="Field">runTCExp</a> <a id="2865" href="V2.TypeChecker.html#2865" class="Bound">γ</a> <a id="2867" class="Symbol">=</a> <a id="2869" href="V2.TypeChecker.html#2113" class="Function">CheckExpressions.checkExp</a> <a id="2895" href="V2.TypeChecker.html#2865" class="Bound">γ</a> <a id="2897" href="V2.TypeChecker.html#2851" class="Bound">e</a> <a id="2899" href="V2.TypeChecker.html#2853" class="Bound">t</a>

<a id="2902" class="Comment">-- Checking declarations.</a>
<a id="2928" class="Comment">---------------------------------------------------------------------------</a>

<a id="3005" class="Comment">-- Monad for checking declarations.</a>

<a id="3042" class="Comment">-- Variable declarations can be inserted into the top block, thus,</a>
<a id="3109" class="Comment">-- we need to treat the top block as mutable state.</a>

<a id="3162" class="Keyword">record</a> <a id="TCDecl"></a><a id="3169" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="3176" href="V2.TypeChecker.html#3176" class="Bound">Γ</a> <a id="3178" href="V2.TypeChecker.html#3178" class="Bound">Γ&#39;</a> <a id="3181" class="Symbol">(</a><a id="3182" href="V2.TypeChecker.html#3182" class="Bound">A</a> <a id="3184" class="Symbol">:</a> <a id="3186" class="PrimitiveType">Set</a><a id="3189" class="Symbol">)</a> <a id="3191" class="Symbol">:</a> <a id="3193" class="PrimitiveType">Set</a> <a id="3197" class="Keyword">where</a>
  <a id="3205" class="Keyword">field</a>
    <a id="TCDecl.runTCDecl"></a><a id="3215" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="3225" class="Symbol">:</a> <a id="3227" href="V2.TypeChecker.html#364" class="Function">TCCxt</a> <a id="3233" href="V2.TypeChecker.html#3176" class="Bound">Γ</a> <a id="3235" class="Symbol">→</a> <a id="3237" href="Library.Error.html#170" class="Function">Error</a> <a id="3243" class="Symbol">(</a><a id="3244" href="V2.TypeChecker.html#3182" class="Bound">A</a> <a id="3246" href="Data.Product.html#1162" class="Function Operator">×</a> <a id="3248" href="V2.TypeChecker.html#364" class="Function">TCCxt</a> <a id="3254" href="V2.TypeChecker.html#3178" class="Bound">Γ&#39;</a><a id="3256" class="Symbol">)</a>
<a id="3258" class="Keyword">open</a> <a id="3263" href="V2.TypeChecker.html#3169" class="Module">TCDecl</a>

<a id="3271" class="Keyword">module</a> <a id="CheckDeclarations"></a><a id="3278" href="V2.TypeChecker.html#3278" class="Module">CheckDeclarations</a> <a id="3296" class="Keyword">where</a>

  <a id="3305" class="Comment">-- TCDecl is a monad.</a>

  <a id="3330" class="Keyword">private</a>

    <a id="CheckDeclarations.returnTCDecl"></a><a id="3343" href="V2.TypeChecker.html#3343" class="Function">returnTCDecl</a> <a id="3356" class="Symbol">:</a> <a id="3358" class="Symbol">∀</a> <a id="3360" class="Symbol">{</a><a id="3361" href="V2.TypeChecker.html#3361" class="Bound">Γ</a> <a id="3363" href="V2.TypeChecker.html#3363" class="Bound">A</a><a id="3364" class="Symbol">}</a> <a id="3366" class="Symbol">(</a><a id="3367" href="V2.TypeChecker.html#3367" class="Bound">a</a> <a id="3369" class="Symbol">:</a> <a id="3371" href="V2.TypeChecker.html#3363" class="Bound">A</a><a id="3372" class="Symbol">)</a> <a id="3374" class="Symbol">→</a> <a id="3376" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="3383" href="V2.TypeChecker.html#3361" class="Bound">Γ</a> <a id="3385" href="V2.TypeChecker.html#3361" class="Bound">Γ</a> <a id="3387" href="V2.TypeChecker.html#3363" class="Bound">A</a>
    <a id="3393" href="V2.TypeChecker.html#3343" class="Function">returnTCDecl</a> <a id="3406" href="V2.TypeChecker.html#3406" class="Bound">a</a> <a id="3408" class="Symbol">.</a><a id="3409" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="3419" href="V2.TypeChecker.html#3419" class="Bound">γ</a> <a id="3421" class="Symbol">=</a> <a id="3423" href="Library.Error.html#268" class="InductiveConstructor">ok</a> <a id="3426" class="Symbol">(</a><a id="3427" href="V2.TypeChecker.html#3406" class="Bound">a</a> <a id="3429" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3431" href="V2.TypeChecker.html#3419" class="Bound">γ</a><a id="3432" class="Symbol">)</a>

    <a id="CheckDeclarations.bindTCDecl"></a><a id="3439" href="V2.TypeChecker.html#3439" class="Function">bindTCDecl</a> <a id="3450" class="Symbol">:</a> <a id="3452" class="Symbol">∀{</a><a id="3454" href="V2.TypeChecker.html#3454" class="Bound">Γ</a> <a id="3456" href="V2.TypeChecker.html#3456" class="Bound">Γ′</a> <a id="3459" href="V2.TypeChecker.html#3459" class="Bound">Γ″</a> <a id="3462" href="V2.TypeChecker.html#3462" class="Bound">A</a> <a id="3464" href="V2.TypeChecker.html#3464" class="Bound">B</a><a id="3465" class="Symbol">}</a>
      <a id="3473" class="Symbol">(</a><a id="3474" href="V2.TypeChecker.html#3474" class="Bound">m</a> <a id="3476" class="Symbol">:</a>     <a id="3482" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="3489" href="V2.TypeChecker.html#3454" class="Bound">Γ</a>  <a id="3492" href="V2.TypeChecker.html#3456" class="Bound">Γ′</a> <a id="3495" href="V2.TypeChecker.html#3462" class="Bound">A</a><a id="3496" class="Symbol">)</a>
      <a id="3504" class="Symbol">(</a><a id="3505" href="V2.TypeChecker.html#3505" class="Bound">k</a> <a id="3507" class="Symbol">:</a> <a id="3509" href="V2.TypeChecker.html#3462" class="Bound">A</a> <a id="3511" class="Symbol">→</a> <a id="3513" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="3520" href="V2.TypeChecker.html#3456" class="Bound">Γ′</a> <a id="3523" href="V2.TypeChecker.html#3459" class="Bound">Γ″</a> <a id="3526" href="V2.TypeChecker.html#3464" class="Bound">B</a><a id="3527" class="Symbol">)</a>
             <a id="3542" class="Symbol">→</a> <a id="3544" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="3551" href="V2.TypeChecker.html#3454" class="Bound">Γ</a>  <a id="3554" href="V2.TypeChecker.html#3459" class="Bound">Γ″</a> <a id="3557" href="V2.TypeChecker.html#3464" class="Bound">B</a>

    <a id="3564" href="V2.TypeChecker.html#3439" class="Function">bindTCDecl</a> <a id="3575" href="V2.TypeChecker.html#3575" class="Bound">m</a> <a id="3577" href="V2.TypeChecker.html#3577" class="Bound">k</a> <a id="3579" class="Symbol">.</a><a id="3580" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="3590" href="V2.TypeChecker.html#3590" class="Bound">γ</a> <a id="3592" class="Symbol">=</a>
      <a id="3600" href="Function.html#3662" class="Function Operator">case</a> <a id="3605" href="V2.TypeChecker.html#3575" class="Bound">m</a> <a id="3607" class="Symbol">.</a><a id="3608" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="3618" href="V2.TypeChecker.html#3590" class="Bound">γ</a> <a id="3620" href="Function.html#3662" class="Function Operator">of</a> <a id="3623" class="Symbol">λ</a> <a id="3625" class="Keyword">where</a>
        <a id="3639" class="Symbol">(</a><a id="3640" href="Library.Error.html#238" class="InductiveConstructor">fail</a> <a id="3645" href="V2.TypeChecker.html#3645" class="Bound">err</a><a id="3648" class="Symbol">)</a>    <a id="3653" class="Symbol">→</a> <a id="3655" href="Library.Error.html#238" class="InductiveConstructor">fail</a> <a id="3660" href="V2.TypeChecker.html#3645" class="Bound">err</a>
        <a id="3672" class="Symbol">(</a><a id="3673" href="Library.Error.html#268" class="InductiveConstructor">ok</a> <a id="3676" class="Symbol">(</a><a id="3677" href="V2.TypeChecker.html#3677" class="Bound">a</a> <a id="3679" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3681" href="V2.TypeChecker.html#3681" class="Bound">γ&#39;</a><a id="3683" class="Symbol">))</a> <a id="3686" class="Symbol">→</a> <a id="3688" href="V2.TypeChecker.html#3577" class="Bound">k</a> <a id="3690" href="V2.TypeChecker.html#3677" class="Bound">a</a> <a id="3692" class="Symbol">.</a><a id="3693" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="3703" href="V2.TypeChecker.html#3681" class="Bound">γ&#39;</a>


  <a id="3710" class="Keyword">instance</a>
    <a id="CheckDeclarations.functorTCDecl"></a><a id="3723" href="V2.TypeChecker.html#3723" class="Function">functorTCDecl</a> <a id="3737" class="Symbol">:</a> <a id="3739" class="Symbol">∀</a> <a id="3741" class="Symbol">{</a><a id="3742" href="V2.TypeChecker.html#3742" class="Bound">Γ</a> <a id="3744" href="V2.TypeChecker.html#3744" class="Bound">Γ′</a><a id="3746" class="Symbol">}</a> <a id="3748" class="Symbol">→</a> <a id="3750" href="Library.Monad.html#157" class="Record">Functor</a> <a id="3758" class="Symbol">(</a><a id="3759" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="3766" href="V2.TypeChecker.html#3742" class="Bound">Γ</a> <a id="3768" href="V2.TypeChecker.html#3744" class="Bound">Γ′</a><a id="3770" class="Symbol">)</a>
    <a id="3776" href="Library.Monad.html#245" class="Field">fmap</a> <a id="3781" class="Symbol">{{</a><a id="3783" href="V2.TypeChecker.html#3723" class="Function">functorTCDecl</a><a id="3796" class="Symbol">}}</a> <a id="3799" href="V2.TypeChecker.html#3799" class="Bound">f</a> <a id="3801" href="V2.TypeChecker.html#3801" class="Bound">m</a> <a id="3803" class="Symbol">=</a> <a id="3805" href="V2.TypeChecker.html#3439" class="Function">bindTCDecl</a> <a id="3816" href="V2.TypeChecker.html#3801" class="Bound">m</a> <a id="3818" class="Symbol">(</a><a id="3819" href="V2.TypeChecker.html#3343" class="Function">returnTCDecl</a> <a id="3832" href="Function.html#3311" class="Function Operator">∘′</a> <a id="3835" href="V2.TypeChecker.html#3799" class="Bound">f</a><a id="3836" class="Symbol">)</a>

    <a id="CheckDeclarations.iApplicativeTCDecl"></a><a id="3843" href="V2.TypeChecker.html#3843" class="Function">iApplicativeTCDecl</a> <a id="3862" class="Symbol">:</a> <a id="3864" href="Library.Monad.html#368" class="Record">IApplicative</a> <a id="3877" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a>
    <a id="3888" href="Library.Monad.html#487" class="Field">pure</a>  <a id="3894" class="Symbol">{{</a><a id="3896" href="V2.TypeChecker.html#3843" class="Function">iApplicativeTCDecl</a><a id="3914" class="Symbol">}}</a>       <a id="3923" class="Symbol">=</a> <a id="3925" href="V2.TypeChecker.html#3343" class="Function">returnTCDecl</a>
    <a id="3942" href="Library.Monad.html#521" class="Field Operator">_&lt;*&gt;_</a> <a id="3948" class="Symbol">{{</a><a id="3950" href="V2.TypeChecker.html#3843" class="Function">iApplicativeTCDecl</a><a id="3968" class="Symbol">}}</a> <a id="3971" href="V2.TypeChecker.html#3971" class="Bound">mf</a> <a id="3974" href="V2.TypeChecker.html#3974" class="Bound">mx</a> <a id="3977" class="Symbol">=</a> <a id="3979" href="V2.TypeChecker.html#3439" class="Function">bindTCDecl</a> <a id="3990" href="V2.TypeChecker.html#3971" class="Bound">mf</a> <a id="3993" class="Symbol">(</a><a id="3994" href="Library.Monad.html#284" class="Function Operator">_&lt;$&gt;</a> <a id="3999" href="V2.TypeChecker.html#3974" class="Bound">mx</a><a id="4001" class="Symbol">)</a>

    <a id="CheckDeclarations.iMonadTCDecl"></a><a id="4008" href="V2.TypeChecker.html#4008" class="Function">iMonadTCDecl</a> <a id="4021" class="Symbol">:</a> <a id="4023" href="Library.Monad.html#867" class="Record">IMonad</a> <a id="4030" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a>
    <a id="4041" href="Library.Monad.html#1002" class="Field Operator">_&gt;&gt;=_</a> <a id="4047" class="Symbol">{{</a><a id="4049" href="V2.TypeChecker.html#4008" class="Function">iMonadTCDecl</a><a id="4061" class="Symbol">}}</a> <a id="4064" class="Symbol">=</a> <a id="4066" href="V2.TypeChecker.html#3439" class="Function">bindTCDecl</a>

  <a id="4080" class="Comment">-- Lifting a TCExp computation into TCDecl.</a>

  <a id="CheckDeclarations.lift"></a><a id="4127" href="V2.TypeChecker.html#4127" class="Function">lift</a> <a id="4132" class="Symbol">:</a> <a id="4134" class="Symbol">∀{</a><a id="4136" href="V2.TypeChecker.html#4136" class="Bound">Γ</a> <a id="4138" href="V2.TypeChecker.html#4138" class="Bound">A</a><a id="4139" class="Symbol">}</a> <a id="4141" class="Symbol">(</a><a id="4142" href="V2.TypeChecker.html#4142" class="Bound">m</a> <a id="4144" class="Symbol">:</a> <a id="4146" href="V2.TypeChecker.html#2700" class="Record">TCExp</a> <a id="4152" href="V2.TypeChecker.html#4136" class="Bound">Γ</a> <a id="4154" href="V2.TypeChecker.html#4138" class="Bound">A</a><a id="4155" class="Symbol">)</a> <a id="4157" class="Symbol">→</a> <a id="4159" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="4166" href="V2.TypeChecker.html#4136" class="Bound">Γ</a> <a id="4168" href="V2.TypeChecker.html#4136" class="Bound">Γ</a> <a id="4170" href="V2.TypeChecker.html#4138" class="Bound">A</a>
  <a id="4174" href="V2.TypeChecker.html#4127" class="Function">lift</a> <a id="4179" href="V2.TypeChecker.html#4179" class="Bound">m</a> <a id="4181" class="Symbol">.</a><a id="4182" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="4192" href="V2.TypeChecker.html#4192" class="Bound">γ</a> <a id="4194" class="Symbol">=</a>
    <a id="4200" href="Function.html#3662" class="Function Operator">case</a> <a id="4205" href="V2.TypeChecker.html#4179" class="Bound">m</a> <a id="4207" class="Symbol">.</a><a id="4208" href="V2.TypeChecker.html#2742" class="Field">runTCExp</a> <a id="4217" href="V2.TypeChecker.html#4192" class="Bound">γ</a> <a id="4219" href="Function.html#3662" class="Function Operator">of</a> <a id="4222" class="Symbol">λ</a> <a id="4224" class="Keyword">where</a>
      <a id="4236" class="Symbol">(</a><a id="4237" href="Library.Error.html#238" class="InductiveConstructor">fail</a> <a id="4242" href="V2.TypeChecker.html#4242" class="Bound">err</a><a id="4245" class="Symbol">)</a> <a id="4247" class="Symbol">→</a> <a id="4249" href="Library.Error.html#238" class="InductiveConstructor">fail</a> <a id="4254" href="V2.TypeChecker.html#4242" class="Bound">err</a>
      <a id="4264" class="Symbol">(</a><a id="4265" href="Library.Error.html#268" class="InductiveConstructor">ok</a> <a id="4268" href="V2.TypeChecker.html#4268" class="Bound">a</a><a id="4269" class="Symbol">)</a>     <a id="4275" class="Symbol">→</a> <a id="4277" href="Library.Error.html#268" class="InductiveConstructor">ok</a> <a id="4280" class="Symbol">(</a><a id="4281" href="V2.TypeChecker.html#4268" class="Bound">a</a> <a id="4283" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4285" href="V2.TypeChecker.html#4192" class="Bound">γ</a><a id="4286" class="Symbol">)</a>

  <a id="4291" class="Comment">-- Add a variable declaration.</a>

  <a id="CheckDeclarations.addVar"></a><a id="4325" href="V2.TypeChecker.html#4325" class="Function">addVar</a> <a id="4332" class="Symbol">:</a> <a id="4334" class="Symbol">∀{</a><a id="4336" href="V2.TypeChecker.html#4336" class="Bound">Γ</a><a id="4337" class="Symbol">}</a> <a id="4339" class="Symbol">(</a><a id="4340" href="V2.TypeChecker.html#4340" class="Bound">x</a> <a id="4342" class="Symbol">:</a> <a id="4344" href="V2.TypeChecker.html#245" class="Function">Name</a><a id="4348" class="Symbol">)</a> <a id="4350" href="V2.TypeChecker.html#4350" class="Bound">t</a> <a id="4352" class="Symbol">→</a> <a id="4354" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="4361" href="V2.TypeChecker.html#4336" class="Bound">Γ</a> <a id="4363" class="Symbol">(</a><a id="4364" href="V2.TypeChecker.html#4350" class="Bound">t</a> <a id="4366" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="4368" href="V2.TypeChecker.html#4336" class="Bound">Γ</a><a id="4369" class="Symbol">)</a> <a id="4371" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>
  <a id="4375" href="V2.TypeChecker.html#4325" class="Function">addVar</a> <a id="4382" class="Symbol">{</a><a id="4383" class="Argument">Γ</a> <a id="4385" class="Symbol">=</a> <a id="4387" href="V2.TypeChecker.html#4387" class="Bound">Γ</a><a id="4388" class="Symbol">}</a> <a id="4390" href="V2.TypeChecker.html#4390" class="Bound">x</a> <a id="4392" href="V2.TypeChecker.html#4392" class="Bound">t</a> <a id="4394" class="Symbol">.</a><a id="4395" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="4405" href="V2.TypeChecker.html#4405" class="Bound">γ</a> <a id="4407" class="Symbol">=</a> <a id="4409" href="Library.Error.html#268" class="InductiveConstructor">ok</a> <a id="4412" class="Symbol">(_</a> <a id="4415" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4417" class="Symbol">(</a><a id="4418" href="V2.TypeChecker.html#4392" class="Bound">t</a> <a id="4420" href="Library.List.html#1527" class="Function Operator">↦</a> <a id="4422" href="V2.TypeChecker.html#4390" class="Bound">x</a> <a id="4424" href="Library.List.html#1527" class="Function Operator">∷</a> <a id="4426" href="V2.TypeChecker.html#4405" class="Bound">γ</a><a id="4427" class="Symbol">))</a>

  <a id="4433" class="Comment">-- Computing the final context.</a>

  <a id="CheckDeclarations.Next"></a><a id="4468" href="V2.TypeChecker.html#4468" class="Function">Next</a> <a id="4473" class="Symbol">:</a> <a id="4475" class="Symbol">(</a><a id="4476" href="V2.TypeChecker.html#4476" class="Bound">Γ</a> <a id="4478" class="Symbol">:</a> <a id="4480" href="V2.WellTypedSyntax.html#255" class="Function">Cxt</a><a id="4483" class="Symbol">)</a> <a id="4485" class="Symbol">(</a><a id="4486" href="V2.TypeChecker.html#4486" class="Bound">s</a> <a id="4488" class="Symbol">:</a> <a id="4490" href="V2.AST.html#973" class="Record">A.Decl</a><a id="4496" class="Symbol">)</a> <a id="4498" class="Symbol">→</a> <a id="4500" href="V2.WellTypedSyntax.html#255" class="Function">Cxt</a>
  <a id="4506" href="V2.TypeChecker.html#4468" class="Function">Next</a> <a id="4511" href="V2.TypeChecker.html#4511" class="Bound">Γ</a> <a id="4513" href="V2.TypeChecker.html#4513" class="Bound">s</a> <a id="4515" class="Symbol">=</a> <a id="4517" href="V2.AST.html#1018" class="Field">A.declType</a> <a id="4528" href="V2.TypeChecker.html#4513" class="Bound">s</a> <a id="4530" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="4532" href="V2.TypeChecker.html#4511" class="Bound">Γ</a>

  <a id="CheckDeclarations.Nexts"></a><a id="4537" href="V2.TypeChecker.html#4537" class="Function">Nexts</a> <a id="4543" class="Symbol">:</a> <a id="4545" class="Symbol">(</a><a id="4546" href="V2.TypeChecker.html#4546" class="Bound">Γ</a> <a id="4548" class="Symbol">:</a> <a id="4550" href="V2.WellTypedSyntax.html#255" class="Function">Cxt</a><a id="4553" class="Symbol">)</a> <a id="4555" class="Symbol">(</a><a id="4556" href="V2.TypeChecker.html#4556" class="Bound">ss</a> <a id="4559" class="Symbol">:</a> <a id="4561" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="4566" href="V2.AST.html#973" class="Record">A.Decl</a><a id="4572" class="Symbol">)</a> <a id="4574" class="Symbol">→</a> <a id="4576" href="V2.WellTypedSyntax.html#255" class="Function">Cxt</a>
  <a id="4582" href="V2.TypeChecker.html#4537" class="Function">Nexts</a> <a id="4588" class="Symbol">=</a> <a id="4590" href="Data.List.Base.html#3533" class="Function">foldl</a> <a id="4596" href="V2.TypeChecker.html#4468" class="Function">Next</a>

  <a id="4604" class="Keyword">mutual</a>

    <a id="4616" class="Comment">-- Checking a single declaration.</a>

    <a id="CheckDeclarations.checkDecl"></a><a id="4655" href="V2.TypeChecker.html#4655" class="Function">checkDecl</a> <a id="4665" class="Symbol">:</a> <a id="4667" class="Symbol">∀</a> <a id="4669" class="Symbol">{</a><a id="4670" href="V2.TypeChecker.html#4670" class="Bound">Γ</a><a id="4671" class="Symbol">}</a> <a id="4673" class="Symbol">(</a><a id="4674" href="V2.TypeChecker.html#4674" class="Bound">d</a> <a id="4676" class="Symbol">:</a> <a id="4678" href="V2.AST.html#973" class="Record">A.Decl</a><a id="4684" class="Symbol">)</a> <a id="4686" class="Symbol">(</a><a id="4687" class="Keyword">let</a> <a id="4691" href="V2.TypeChecker.html#4691" class="Bound">t</a> <a id="4693" class="Symbol">=</a> <a id="4695" href="V2.AST.html#1018" class="Field">A.declType</a> <a id="4706" href="V2.TypeChecker.html#4674" class="Bound">d</a><a id="4707" class="Symbol">)</a>
      <a id="4715" class="Symbol">→</a> <a id="4717" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="4724" href="V2.TypeChecker.html#4670" class="Bound">Γ</a> <a id="4726" class="Symbol">(</a><a id="4727" href="V2.TypeChecker.html#4691" class="Bound">t</a> <a id="4729" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="4731" href="V2.TypeChecker.html#4670" class="Bound">Γ</a><a id="4732" class="Symbol">)</a> <a id="4734" class="Symbol">(</a><a id="4735" href="V2.WellTypedSyntax.html#890" class="Datatype">Decl</a> <a id="4740" href="V2.TypeChecker.html#4670" class="Bound">Γ</a> <a id="4742" href="V2.TypeChecker.html#4691" class="Bound">t</a><a id="4743" class="Symbol">)</a>

    <a id="4750" href="V2.TypeChecker.html#4655" class="Function">checkDecl</a> <a id="4760" class="Symbol">(</a><a id="4761" href="V2.AST.html#1004" class="InductiveConstructor">A.dInit</a> <a id="4769" href="V2.TypeChecker.html#4769" class="Bound">t</a> <a id="4771" href="V2.TypeChecker.html#4771" class="Bound">x</a> <a id="4773" href="V2.TypeChecker.html#4773" class="Bound">e</a><a id="4774" class="Symbol">)</a> <a id="4776" class="Symbol">=</a> <a id="4778" class="Keyword">do</a>
      <a id="4787" href="V2.TypeChecker.html#4787" class="Bound">e&#39;</a> <a id="4790" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="4792" href="V2.TypeChecker.html#4127" class="Function">lift</a> <a id="4797" href="Function.html#1645" class="Function Operator">$</a> <a id="4799" href="V2.TypeChecker.html#2783" class="Function">checkExp</a> <a id="4808" href="V2.TypeChecker.html#4773" class="Bound">e</a> <a id="4810" href="V2.TypeChecker.html#4769" class="Bound">t</a>
      <a id="4818" href="V2.TypeChecker.html#4325" class="Function">addVar</a> <a id="4825" class="Symbol">(</a><a id="4826" href="V2.TypeChecker.html#260" class="Function">idToName</a> <a id="4835" href="V2.TypeChecker.html#4771" class="Bound">x</a><a id="4836" class="Symbol">)</a> <a id="4838" href="V2.TypeChecker.html#4769" class="Bound">t</a>
      <a id="4846" href="Library.Monad.html#1110" class="Function">return</a> <a id="4853" class="Symbol">(</a><a id="4854" href="V2.WellTypedSyntax.html#930" class="InductiveConstructor">dInit</a> <a id="4860" href="V2.TypeChecker.html#4787" class="Bound">e&#39;</a><a id="4862" class="Symbol">)</a>

    <a id="4869" class="Comment">-- Checking a list of declarations.</a>

    <a id="CheckDeclarations.checkDecls"></a><a id="4910" href="V2.TypeChecker.html#4910" class="Function">checkDecls</a> <a id="4921" class="Symbol">:</a> <a id="4923" class="Symbol">∀</a> <a id="4925" class="Symbol">{</a><a id="4926" href="V2.TypeChecker.html#4926" class="Bound">Γ</a><a id="4927" class="Symbol">}</a> <a id="4929" class="Symbol">(</a><a id="4930" href="V2.TypeChecker.html#4930" class="Bound">ds</a> <a id="4933" class="Symbol">:</a> <a id="4935" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="4940" href="V2.AST.html#973" class="Record">A.Decl</a><a id="4946" class="Symbol">)</a> <a id="4948" class="Symbol">(</a><a id="4949" class="Keyword">let</a> <a id="4953" href="V2.TypeChecker.html#4953" class="Bound">Γ&#39;</a> <a id="4956" class="Symbol">=</a> <a id="4958" href="V2.TypeChecker.html#4537" class="Function">Nexts</a> <a id="4964" href="V2.TypeChecker.html#4926" class="Bound">Γ</a> <a id="4966" href="V2.TypeChecker.html#4930" class="Bound">ds</a><a id="4968" class="Symbol">)</a>
      <a id="4976" class="Symbol">→</a> <a id="4978" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="4985" href="V2.TypeChecker.html#4926" class="Bound">Γ</a> <a id="4987" href="V2.TypeChecker.html#4953" class="Bound">Γ&#39;</a> <a id="4990" class="Symbol">(</a><a id="4991" href="V2.WellTypedSyntax.html#969" class="Datatype">Decls</a> <a id="4997" href="V2.TypeChecker.html#4926" class="Bound">Γ</a> <a id="4999" href="V2.TypeChecker.html#4953" class="Bound">Γ&#39;</a><a id="5001" class="Symbol">)</a>

    <a id="5008" href="V2.TypeChecker.html#4910" class="Function">checkDecls</a> <a id="5019" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a>       <a id="5028" class="Symbol">=</a> <a id="5030" href="Library.Monad.html#1110" class="Function">return</a> <a id="5037" href="V2.WellTypedSyntax.html#1005" class="InductiveConstructor">[]</a>
    <a id="5044" href="V2.TypeChecker.html#4910" class="Function">checkDecls</a> <a id="5055" class="Symbol">(</a><a id="5056" href="V2.TypeChecker.html#5056" class="Bound">d</a> <a id="5058" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="5060" href="V2.TypeChecker.html#5060" class="Bound">ds</a><a id="5062" class="Symbol">)</a> <a id="5064" class="Symbol">=</a> <a id="5066" class="Keyword">do</a>
      <a id="5075" href="V2.TypeChecker.html#5075" class="Bound">d&#39;</a> <a id="5078" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="5080" href="V2.TypeChecker.html#4655" class="Function">checkDecl</a> <a id="5090" href="V2.TypeChecker.html#5056" class="Bound">d</a>
      <a id="5098" class="Symbol">(</a><a id="5099" href="V2.TypeChecker.html#5075" class="Bound">d&#39;</a> <a id="5102" href="V2.WellTypedSyntax.html#1023" class="InductiveConstructor Operator">∷_</a><a id="5104" class="Symbol">)</a> <a id="5106" href="Library.Monad.html#284" class="Function Operator">&lt;$&gt;</a> <a id="5110" href="V2.TypeChecker.html#4910" class="Function">checkDecls</a> <a id="5121" href="V2.TypeChecker.html#5060" class="Bound">ds</a>

  <a id="5127" class="Comment">-- Checking the program in TCDecl.</a>

  <a id="CheckDeclarations.checkProgram"></a><a id="5165" href="V2.TypeChecker.html#5165" class="Function">checkProgram</a> <a id="5178" class="Symbol">:</a> <a id="5180" class="Symbol">(</a><a id="5181" href="V2.TypeChecker.html#5181" class="Bound">prg</a> <a id="5185" class="Symbol">:</a> <a id="5187" href="V2.AST.html#1156" class="Record">A.Program</a><a id="5196" class="Symbol">)</a> <a id="5198" class="Symbol">(</a><a id="5199" class="Keyword">let</a> <a id="5203" href="V2.TypeChecker.html#5203" class="Bound">Γ</a> <a id="5205" class="Symbol">=</a> <a id="5207" href="V2.TypeChecker.html#4537" class="Function">Nexts</a> <a id="5213" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a> <a id="5216" class="Symbol">(</a><a id="5217" href="V2.AST.html#1210" class="Field">A.theDecls</a> <a id="5228" href="V2.TypeChecker.html#5181" class="Bound">prg</a><a id="5231" class="Symbol">))</a>
    <a id="5238" class="Symbol">→</a> <a id="5240" href="V2.TypeChecker.html#3169" class="Record">TCDecl</a> <a id="5247" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a> <a id="5250" href="V2.TypeChecker.html#5203" class="Bound">Γ</a> <a id="5252" href="V2.WellTypedSyntax.html#1159" class="Record">Program</a>

  <a id="5263" href="V2.TypeChecker.html#5165" class="Function">checkProgram</a> <a id="5276" class="Symbol">(</a><a id="5277" href="V2.AST.html#1190" class="InductiveConstructor">A.program</a> <a id="5287" href="V2.TypeChecker.html#5287" class="Bound">ds</a> <a id="5290" href="V2.TypeChecker.html#5290" class="Bound">e</a><a id="5291" class="Symbol">)</a> <a id="5293" class="Symbol">=</a> <a id="5295" class="Keyword">do</a>
    <a id="5302" href="V2.TypeChecker.html#5302" class="Bound">ds&#39;</a> <a id="5306" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="5308" href="V2.TypeChecker.html#4910" class="Function">checkDecls</a> <a id="5319" href="V2.TypeChecker.html#5287" class="Bound">ds</a>
    <a id="5326" href="V2.TypeChecker.html#5326" class="Bound">e&#39;</a>  <a id="5330" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="5332" href="V2.TypeChecker.html#4127" class="Function">lift</a> <a id="5337" href="Function.html#1645" class="Function Operator">$</a> <a id="5339" href="V2.TypeChecker.html#2783" class="Function">checkExp</a> <a id="5348" href="V2.TypeChecker.html#5290" class="Bound">e</a> <a id="5350" href="V2.AST.html#396" class="InductiveConstructor">int</a>
    <a id="5358" href="Library.Monad.html#1110" class="Function">return</a> <a id="5365" class="Symbol">(</a><a id="5366" href="V2.WellTypedSyntax.html#1193" class="InductiveConstructor">program</a> <a id="5374" href="V2.TypeChecker.html#5302" class="Bound">ds&#39;</a> <a id="5378" href="V2.TypeChecker.html#5326" class="Bound">e&#39;</a><a id="5380" class="Symbol">)</a>

<a id="5383" class="Comment">-- Checking the program.</a>
<a id="5408" class="Comment">---------------------------------------------------------------------------</a>

<a id="checkProgram"></a><a id="5485" href="V2.TypeChecker.html#5485" class="Function">checkProgram</a> <a id="5498" class="Symbol">:</a> <a id="5500" class="Symbol">(</a><a id="5501" href="V2.TypeChecker.html#5501" class="Bound">prg</a> <a id="5505" class="Symbol">:</a> <a id="5507" href="V2.AST.html#1156" class="Record">A.Program</a><a id="5516" class="Symbol">)</a> <a id="5518" class="Symbol">→</a> <a id="5520" href="Library.Error.html#170" class="Function">Error</a> <a id="5526" href="V2.WellTypedSyntax.html#1159" class="Record">Program</a>
<a id="5534" href="V2.TypeChecker.html#5485" class="Function">checkProgram</a> <a id="5547" href="V2.TypeChecker.html#5547" class="Bound">prg</a> <a id="5551" class="Symbol">=</a> <a id="5553" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="5559" href="Library.Monad.html#284" class="Function Operator">&lt;$&gt;</a> <a id="5563" href="V2.TypeChecker.html#5165" class="Function">CheckDeclarations.checkProgram</a> <a id="5594" href="V2.TypeChecker.html#5547" class="Bound">prg</a> <a id="5598" class="Symbol">.</a><a id="5599" href="V2.TypeChecker.html#3215" class="Field">runTCDecl</a> <a id="5609" href="Data.List.Relation.Unary.All.html#1239" class="InductiveConstructor">[]</a>


<a id="5614" class="Comment">-- -}</a>
<a id="5620" class="Comment">-- -}</a>
<a id="5626" class="Comment">-- -}</a>
<a id="5632" class="Comment">-- -}</a>
<a id="5638" class="Comment">-- -}</a>
<a id="5644" class="Comment">-- -}</a>
</pre></body></html>