<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Jesper Cockx">
  <meta name="dcterms.date" content="2019-09-02">
  <title>Correct-by-construction programming in Agda</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//css/theme/black.css" id="theme">
  <link rel="stylesheet" href="white.css"/>
  <link rel="stylesheet" href="Agda.css"/>
  <link rel="stylesheet" href="patchTheme.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//css/print/pdf.css' : 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Correct-by-construction programming in Agda</h1>
  <p class="subtitle">Lecture 3: Side effects, type classes, and monads</p>
  <p class="author">Jesper Cockx</p>
  <p class="date">2 September 2019</p>
</section>

<section id="section" class="slide level2">
<h2></h2>
<p>“To be is to do” –Socrates</p>
<p>“To do is to be” –Sartre</p>
<p>“Do be do be do” –Sinatra.</p>
</section>
<section><section id="type-classes" class="title-slide slide level1"><h1>Type classes</h1></section><section id="what-is-a-type-class" class="slide level2">
<h2>What is a type class?</h2>
<p>A type class offers one or more functions for a <strong>generic</strong> type. <strong>Examples</strong>:</p>
<ul>
<li><code>Print A</code>:
<ul>
<li><code>print : A → String</code></li>
</ul></li>
<li><code>Monoid M</code> type class:
<ul>
<li><code>∅ : M</code></li>
<li><code>_+_ : M → M → M</code></li>
</ul></li>
<li><code>Eq A</code>:
<ul>
<li><code>_==_ : A → A → Bool</code> and/or <code>_≟_ : (x y : A) -&gt; Dec (x ≡ y)</code></li>
</ul></li>
<li><code>Functor F</code>:
<ul>
<li><code>fmap : {A B : Set} → F A → F B</code></li>
</ul></li>
</ul>
</section><section id="parametric-vs-ad-hoc-overloading" class="slide level2">
<h2>Parametric vs ad-hoc overloading</h2>
<p>Why not have <code>print : {A : Set} -&gt; A -&gt; String</code>?</p>
<div class="fragment">
<p>Because of <em>parametricity</em>, <code>print</code> would have to be a constant function.</p>
<p>Type classes allow a <em>different</em> implementation at each type!</p>
</div>
</section><section id="type-classes-in-agda" class="slide level2">
<h2>Type classes in Agda</h2>
<p>A type class is implemented by using a <strong>record type</strong> + <strong>instance arguments</strong></p>
<ul>
<li>Record type: a <strong>dictionary</strong> holding implementation of each function for a specific type</li>
<li>Instance arguments: <em>automatically</em> pick the ‘right’ dictionary for the given type</li>
</ul>
</section><section id="instance-arguments" class="slide level2">
<h2>Instance arguments</h2>
<p><em>Instance arguments</em> are Agda’s builtin mechanism for ad-hoc overloading (~ type classes in Haskell).</p>
<p>Syntax:</p>
<ul>
<li>Using an instance: <code>{{x : A}} → ...</code></li>
<li>Defining new instances: <code>instance ...</code></li>
</ul>
<p>When using a function of type <code>{{x : A}} → B</code>, Agda will automatically resolve the argument if there is a <strong>unique</strong> instance of the right type in scope.</p>
</section><section id="defining-a-typeclass-with-instance-arguments" class="slide level2">
<h2>Defining a typeclass with instance arguments</h2>
<!--
<pre class="Agda"><a id="1644" class="Keyword">module</a> <a id="1651" href="slides3.html" class="Module">_</a> <a id="1653" class="Keyword">where</a>
<a id="1659" class="Keyword">open</a> <a id="1664" class="Keyword">import</a> <a id="1671" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="1686" class="Keyword">open</a> <a id="1691" class="Keyword">import</a> <a id="1698" href="Data.String.Base.html" class="Module">Data.String.Base</a>
</pre>-->
<pre class="Agda"><a id="1732" class="Keyword">record</a> <a id="Print"></a><a id="1739" href="slides3.html#1739" class="Record">Print</a> <a id="1745" class="Symbol">{</a><a id="1746" href="slides3.html#1746" class="Bound">ℓ</a><a id="1747" class="Symbol">}</a> <a id="1749" class="Symbol">(</a><a id="1750" href="slides3.html#1750" class="Bound">A</a> <a id="1752" class="Symbol">:</a> <a id="1754" class="PrimitiveType">Set</a> <a id="1758" href="slides3.html#1746" class="Bound">ℓ</a><a id="1759" class="Symbol">)</a> <a id="1761" class="Symbol">:</a> <a id="1763" class="PrimitiveType">Set</a> <a id="1767" href="slides3.html#1746" class="Bound">ℓ</a> <a id="1769" class="Keyword">where</a>
  <a id="1777" class="Keyword">field</a>
    <a id="Print.print"></a><a id="1787" href="slides3.html#1787" class="Field">print</a> <a id="1793" class="Symbol">:</a> <a id="1795" href="slides3.html#1750" class="Bound">A</a> <a id="1797" class="Symbol">→</a> <a id="1799" href="Agda.Builtin.String.html#247" class="Postulate">String</a>
<a id="1806" class="Keyword">open</a> <a id="1811" href="slides3.html#1739" class="Module">Print</a> <a id="1817" class="Symbol">{{...}}</a>  <a id="1826" class="Comment">-- print : {{r : Print A}} → A → String</a>

<a id="1867" class="Keyword">instance</a>
  <a id="PrintBool"></a><a id="1878" href="slides3.html#1878" class="Function">PrintBool</a> <a id="1888" class="Symbol">:</a> <a id="1890" href="slides3.html#1739" class="Record">Print</a> <a id="1896" href="Agda.Builtin.Bool.html#135" class="Datatype">Bool</a>
  <a id="1903" href="slides3.html#1787" class="Field">print</a> <a id="1909" class="Symbol">{{</a><a id="1911" href="slides3.html#1878" class="Function">PrintBool</a><a id="1920" class="Symbol">}}</a> <a id="1923" href="Agda.Builtin.Bool.html#160" class="InductiveConstructor">true</a>  <a id="1929" class="Symbol">=</a> <a id="1931" class="String">&quot;true&quot;</a>
  <a id="1940" href="slides3.html#1787" class="Field">print</a> <a id="1946" class="Symbol">{{</a><a id="1948" href="slides3.html#1878" class="Function">PrintBool</a><a id="1957" class="Symbol">}}</a> <a id="1960" href="Agda.Builtin.Bool.html#154" class="InductiveConstructor">false</a> <a id="1966" class="Symbol">=</a> <a id="1968" class="String">&quot;false&quot;</a>

  <a id="PrintString"></a><a id="1979" href="slides3.html#1979" class="Function">PrintString</a> <a id="1991" class="Symbol">:</a> <a id="1993" href="slides3.html#1739" class="Record">Print</a> <a id="1999" href="Agda.Builtin.String.html#247" class="Postulate">String</a>
  <a id="2008" href="slides3.html#1787" class="Field">print</a> <a id="2014" class="Symbol">{{</a><a id="2016" href="slides3.html#1979" class="Function">PrintString</a><a id="2027" class="Symbol">}}</a> <a id="2030" href="slides3.html#2030" class="Bound">x</a> <a id="2032" class="Symbol">=</a> <a id="2034" href="slides3.html#2030" class="Bound">x</a>

<a id="testPrint"></a><a id="2037" href="slides3.html#2037" class="Function">testPrint</a> <a id="2047" class="Symbol">:</a> <a id="2049" href="Agda.Builtin.String.html#247" class="Postulate">String</a>
<a id="2056" href="slides3.html#2037" class="Function">testPrint</a> <a id="2066" class="Symbol">=</a> <a id="2068" class="Symbol">(</a><a id="2069" href="slides3.html#1787" class="Field">print</a> <a id="2075" href="Agda.Builtin.Bool.html#160" class="InductiveConstructor">true</a><a id="2079" class="Symbol">)</a> <a id="2081" href="Data.String.Base.html#1744" class="Function Operator">++</a> <a id="2084" class="Symbol">(</a><a id="2085" href="slides3.html#1787" class="Field">print</a> <a id="2091" class="String">&quot;a string&quot;</a><a id="2101" class="Symbol">)</a>
</pre>
</section></section>
<section><section id="monads" class="title-slide slide level1"><h1>Monads</h1></section><section id="side-effects-in-a-pure-language" class="slide level2">
<h2>Side effects in a pure language</h2>
<p>Agda is a <strong>pure</strong> language: functions have no side effects</p>
<p>But a typechecker has many side effects:</p>
<ul>
<li>raise error messages</li>
<li>read or write files</li>
<li>maintain a state for declared variables</li>
</ul>
</section><section id="monads-1" class="slide level2">
<h2>Monads</h2>
<p><code>Monad</code> is a typeclass with two fields <code>return</code> and <code>_&gt;&gt;=_</code>.</p>
<p><code>M A</code> ~ “computations that may have some side-effects (depending on M) and return an A”</p>
<p>Examples: <code>Maybe</code>, <code>Reader</code>, <code>Error</code>, <code>State</code>, …</p>
<p>See <a href="https://jespercockx.github.io/ohrid19-agda/src/html/Library.Error.html">Library/Error.agda</a></p>
</section><section id="do-notation" class="slide level2">
<h2><code>do</code> notation</h2>
<p><code>do</code> is syntactic sugar for repeated binds: instead of</p>
<!--
<pre class="Agda"><a id="2740" class="Keyword">open</a> <a id="2745" class="Keyword">import</a> <a id="2752" href="Library.html" class="Module">Library</a> <a id="2760" class="Keyword">hiding</a> <a id="2767" class="Symbol">(</a><a id="2768" href="Data.List.Relation.Unary.All.html#1176" class="Datatype">All</a><a id="2771" class="Symbol">)</a>
</pre>-->
<pre class="Agda"><a id="2786" href="slides3.html#2786" class="Function">_</a> <a id="2788" class="Symbol">:</a> <a id="2790" href="Data.Maybe.Base.html#795" class="Datatype">Maybe</a> <a id="2796" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a>
<a id="2798" class="Symbol">_</a> <a id="2800" class="Symbol">=</a> <a id="2802" class="Symbol">(</a><a id="2803" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="2808" class="Symbol">(</a><a id="2809" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">-[1+</a> <a id="2814" class="Number">3</a> <a id="2816" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">]</a><a id="2817" class="Symbol">))</a> <a id="2820" href="Library.Monad.html#1002" class="Field Operator">&gt;&gt;=</a> <a id="2824" class="Symbol">λ</a> <a id="2826" href="slides3.html#2826" class="Bound">x</a> <a id="2828" class="Symbol">→</a>
    <a id="2834" class="Symbol">(</a><a id="2835" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="2840" class="Symbol">(</a><a id="2841" href="Agda.Builtin.Int.html#237" class="InductiveConstructor Operator">+</a> <a id="2843" class="Number">5</a><a id="2844" class="Symbol">)</a>     <a id="2850" class="Symbol">)</a> <a id="2852" href="Library.Monad.html#1002" class="Field Operator">&gt;&gt;=</a> <a id="2856" class="Symbol">λ</a> <a id="2858" href="slides3.html#2858" class="Bound">y</a> <a id="2860" class="Symbol">→</a>
    <a id="2866" href="Library.Monad.html#1110" class="Function">return</a> <a id="2873" class="Symbol">(</a><a id="2874" href="slides3.html#2826" class="Bound">x</a> <a id="2876" href="Data.Integer.Base.html#2950" class="Function Operator">+</a> <a id="2878" href="slides3.html#2858" class="Bound">y</a><a id="2879" class="Symbol">)</a>
</pre>
you can write:
<pre class="Agda"><a id="2904" href="slides3.html#2904" class="Function">_</a> <a id="2906" class="Symbol">:</a> <a id="2908" href="Data.Maybe.Base.html#795" class="Datatype">Maybe</a> <a id="2914" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a>
<a id="2916" class="Symbol">_</a> <a id="2918" class="Symbol">=</a> <a id="2920" class="Keyword">do</a>
  <a id="2925" href="slides3.html#2925" class="Bound">x</a> <a id="2927" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2929" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="2934" class="Symbol">(</a><a id="2935" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">-[1+</a> <a id="2940" class="Number">3</a> <a id="2942" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">]</a><a id="2943" class="Symbol">)</a>
  <a id="2947" href="slides3.html#2947" class="Bound">y</a> <a id="2949" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2951" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="2956" class="Symbol">(</a><a id="2957" href="Agda.Builtin.Int.html#237" class="InductiveConstructor Operator">+</a> <a id="2959" class="Number">5</a><a id="2960" class="Symbol">)</a>
  <a id="2964" href="Library.Monad.html#1110" class="Function">return</a> <a id="2971" class="Symbol">(</a><a id="2972" href="slides3.html#2925" class="Bound">x</a> <a id="2974" href="Data.Integer.Base.html#2950" class="Function Operator">+</a> <a id="2976" href="slides3.html#2947" class="Bound">y</a><a id="2977" class="Symbol">)</a>
</pre>
</section><section id="pattern-matching-with-do" class="slide level2">
<h2>Pattern matching with <code>do</code></h2>
<p>There can be a <em>pattern</em> to the left of a <code>←</code>, alternative cases can be handled in a local <code>where</code></p>
<pre class="Agda"><a id="pred"></a><a id="3119" href="slides3.html#3119" class="Function">pred</a> <a id="3124" class="Symbol">:</a> <a id="3126" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="3128" class="Symbol">→</a> <a id="3130" href="Data.Maybe.Base.html#795" class="Datatype">Maybe</a> <a id="3136" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>
<a id="3138" href="slides3.html#3119" class="Function">pred</a> <a id="3143" href="slides3.html#3143" class="Bound">n</a> <a id="3145" class="Symbol">=</a> <a id="3147" class="Keyword">do</a>
  <a id="3152" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="3156" href="slides3.html#3156" class="Bound">m</a> <a id="3158" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="3160" href="Data.Maybe.Base.html#829" class="InductiveConstructor">just</a> <a id="3165" href="slides3.html#3143" class="Bound">n</a>
    <a id="3171" class="Keyword">where</a> <a id="3177" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a> <a id="3182" class="Symbol">→</a> <a id="3184" href="Data.Maybe.Base.html#859" class="InductiveConstructor">nothing</a>
  <a id="3194" href="Library.Monad.html#1110" class="Function">return</a> <a id="3201" href="slides3.html#3156" class="Bound">m</a>
</pre>
</section><section id="dependent-pattern-matching-with-do" class="slide level2">
<h2>Dependent pattern matching with <code>do</code></h2>
<pre class="Agda"><a id="3253" class="Keyword">open</a> <a id="3258" class="Keyword">import</a> <a id="3265" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="3274" class="Keyword">using</a> <a id="3280" class="Symbol">(</a><a id="3281" href="Data.Vec.Base.html#935" class="Datatype">Vec</a><a id="3284" class="Symbol">)</a>

<a id="3287" class="Keyword">postulate</a>
  <a id="test"></a><a id="3299" href="slides3.html#3299" class="Postulate">test</a> <a id="3304" class="Symbol">:</a> <a id="3306" class="Symbol">(</a><a id="3307" href="slides3.html#3307" class="Bound">m</a> <a id="3309" href="slides3.html#3309" class="Bound">n</a> <a id="3311" class="Symbol">:</a> <a id="3313" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="3314" class="Symbol">)</a> <a id="3316" class="Symbol">→</a> <a id="3318" href="Data.Maybe.Base.html#795" class="Datatype">Maybe</a> <a id="3324" class="Symbol">(</a><a id="3325" href="slides3.html#3307" class="Bound">m</a> <a id="3327" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="3329" href="slides3.html#3309" class="Bound">n</a><a id="3330" class="Symbol">)</a>

<a id="cast"></a><a id="3333" href="slides3.html#3333" class="Function">cast</a> <a id="3338" class="Symbol">:</a> <a id="3340" class="Symbol">(</a><a id="3341" href="slides3.html#3341" class="Bound">m</a> <a id="3343" href="slides3.html#3343" class="Bound">n</a> <a id="3345" class="Symbol">:</a> <a id="3347" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="3348" class="Symbol">)</a> <a id="3350" class="Symbol">→</a> <a id="3352" href="Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="3356" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a> <a id="3358" href="slides3.html#3341" class="Bound">m</a> <a id="3360" class="Symbol">→</a> <a id="3362" href="Data.Maybe.Base.html#795" class="Datatype">Maybe</a> <a id="3368" class="Symbol">(</a><a id="3369" href="Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="3373" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a> <a id="3375" href="slides3.html#3343" class="Bound">n</a><a id="3376" class="Symbol">)</a>
<a id="3378" href="slides3.html#3333" class="Function">cast</a> <a id="3383" href="slides3.html#3383" class="Bound">m</a> <a id="3385" href="slides3.html#3385" class="Bound">n</a> <a id="3387" href="slides3.html#3387" class="Bound">xs</a> <a id="3390" class="Symbol">=</a> <a id="3392" class="Keyword">do</a>
  <a id="3397" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="3402" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="3404" href="slides3.html#3299" class="Postulate">test</a> <a id="3409" href="slides3.html#3383" class="Bound">m</a> <a id="3411" href="slides3.html#3385" class="Bound">n</a>
  <a id="3415" href="Library.Monad.html#1110" class="Function">return</a> <a id="3422" href="slides3.html#3387" class="Bound">xs</a>
</pre>
<p>Pattern matching allows typechecker to learn new facts!</p>
</section><section id="type-checking-expressions" class="slide level2">
<h2>Type-checking expressions</h2>
<p>See <a href="https://jespercockx.github.io/ohrid19-agda/src/html/V1/V1.TypeChecker.html">V1/TypeChecker.agda</a>.</p>
<p>Exercise: extend the typechecker with rules for the new syntactic constructions you added before</p>
</section></section>
<section><section id="indexed-monads" class="title-slide slide level1"><h1>Indexed monads</h1></section><section id="typechecking-variable-declarations" class="slide level2">
<h2>Typechecking variable declarations</h2>
<p>For type-checking variables, we need the following side-effects:</p>
<ul>
<li>For checking <em>expressions</em>: find variable with given name (⇒ read-only access)</li>
<li>For checking <em>declarations</em>: add new variable with given name (⇒ read-write access)</li>
</ul>
<p>How to ensure <strong>statically</strong> that each variable in scope has a name?</p>
</section><section id="the-all-type" class="slide level2">
<h2>The <code>All</code> type</h2>
For <code>P : A → Set</code> and <code>xs : List A</code>, <code>All P xs</code> associates an element of <code>P x</code> to each <code>x ∈ xs</code>:
<pre class="Agda"><a id="4200" class="Keyword">data</a> <a id="All"></a><a id="4205" href="slides3.html#4205" class="Datatype">All</a> <a id="4209" class="Symbol">{</a><a id="4210" href="slides3.html#4210" class="Bound">A</a> <a id="4212" class="Symbol">:</a> <a id="4214" class="PrimitiveType">Set</a><a id="4217" class="Symbol">}</a> <a id="4219" class="Symbol">(</a><a id="4220" href="slides3.html#4220" class="Bound">P</a> <a id="4222" class="Symbol">:</a> <a id="4224" href="slides3.html#4210" class="Bound">A</a> <a id="4226" class="Symbol">→</a> <a id="4228" class="PrimitiveType">Set</a><a id="4231" class="Symbol">)</a> <a id="4233" class="Symbol">:</a> <a id="4235" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="4240" href="slides3.html#4210" class="Bound">A</a> <a id="4242" class="Symbol">→</a> <a id="4244" class="PrimitiveType">Set</a> <a id="4248" class="Keyword">where</a>
  <a id="All.[]"></a><a id="4256" href="slides3.html#4256" class="InductiveConstructor">[]</a>  <a id="4260" class="Symbol">:</a> <a id="4262" href="slides3.html#4205" class="Datatype">All</a> <a id="4266" href="slides3.html#4220" class="Bound">P</a> <a id="4268" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a>
  <a id="All._∷_"></a><a id="4273" href="slides3.html#4273" class="InductiveConstructor Operator">_∷_</a> <a id="4277" class="Symbol">:</a> <a id="4279" class="Symbol">∀</a> <a id="4281" class="Symbol">{</a><a id="4282" href="slides3.html#4282" class="Bound">x</a> <a id="4284" href="slides3.html#4284" class="Bound">xs</a><a id="4286" class="Symbol">}</a> <a id="4288" class="Symbol">→</a> <a id="4290" href="slides3.html#4220" class="Bound">P</a> <a id="4292" href="slides3.html#4282" class="Bound">x</a> <a id="4294" class="Symbol">→</a> <a id="4296" href="slides3.html#4205" class="Datatype">All</a> <a id="4300" href="slides3.html#4220" class="Bound">P</a> <a id="4302" href="slides3.html#4284" class="Bound">xs</a> <a id="4305" class="Symbol">→</a> <a id="4307" href="slides3.html#4205" class="Datatype">All</a> <a id="4311" href="slides3.html#4220" class="Bound">P</a> <a id="4313" class="Symbol">(</a><a id="4314" href="slides3.html#4282" class="Bound">x</a> <a id="4316" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="4318" href="slides3.html#4284" class="Bound">xs</a><a id="4320" class="Symbol">)</a>
</pre>
<p>Name for each variable: <code>TCCxt Γ = All (\_ → Name) Γ</code> Value for each variable: <code>Env Γ = All Val Γ</code></p>
</section><section id="adding-new-variables-to-the-typechecking-context" class="slide level2">
<h2>Adding new variables to the typechecking context</h2>
<p>We need to <em>modify</em> both <code>Γ : Cxt</code> and <code>ρ : TCCxt Γ</code>!</p>
<p>Possible solutions:</p>
<ul>
<li>decouple names from the context?</li>
<li>use state of type <code>Σ Cxt TCCxt</code>?</li>
<li><strong>index</strong> the monad by the context Γ!</li>
</ul>
</section><section id="indexed-monads-1" class="slide level2">
<h2>Indexed monads</h2>
<p>An <strong>indexed monad</strong> = a monad with two extra parameters for the (static) <em>input</em> and <em>output</em> states</p>
<ul>
<li><code>return : A → M i i A</code></li>
<li><code>_&gt;&gt;=_  : M i j A → (A → M j k B) → M i k B</code></li>
</ul>
<p>Examples: - <code>TCDecl</code> monad (see <a href="https://jespercockx.github.io/ohrid19-agda/src/html/V2/V2.TypeChecker.html">V2/TypeChecker.agda</a>. - <code>Exec</code> monad (see <a href="https://jespercockx.github.io/ohrid19-agda/src/html/V3/V3.TypeChecker.html">V3/Interpreter.agda</a>.</p>
</section></section>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//lib/js/head.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'linear', // none/fade/slide/convex/concave/zoom
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,
        height: 720,
        // Factor of the display size that should remain empty around the content
        margin: 0.2,
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//plugin/zoom-js/zoom.js', async: true },
          { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//plugin/math/math.js', async: true },
          { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0//plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
